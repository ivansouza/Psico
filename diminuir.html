<!DOCTYPE html>
<html lang="pt-PT">
<head>
    <!-- Google Analytics (gtag.js) -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-HZTRL38JQ5"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());
      gtag('config', 'G-HZTRL38JQ5');
    </script>

    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>T√©cnica de Subtra√ß√£o: Edi√ß√£o Google Analytics</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        .math-font {
            font-family: 'Courier New', Courier, monospace;
        }
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        .animate-fade {
            animation: fadeIn 0.4s ease-out forwards;
        }
    </style>
</head>
<body class="bg-slate-50 min-h-screen text-slate-800 p-4 md:p-8 font-sans">

    <div class="max-w-4xl mx-auto">
        <!-- Cabe√ßalho -->
        <header class="text-center mb-10">
            <h1 class="text-4xl font-bold text-slate-900 mb-4">T√©cnica de Subtra√ß√£o F√°cil</h1>
            <p class="text-lg text-slate-600">Aprenda a subtrair sem empr√©stimos utilizando a regra do -1 e a dist√¢ncia constante.</p>
        </header>

        <div class="grid grid-cols-1 lg:grid-cols-3 gap-8">
            
            <!-- Entrada de Dados -->
            <div class="lg:col-span-2 space-y-6">
                <div class="bg-white rounded-2xl shadow-sm border border-slate-200 p-6">
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                        <div>
                            <label class="block text-sm font-semibold text-slate-700 mb-2">Subtrair de (Base):</label>
                            <input type="number" id="potencia" value="10000" class="w-full p-3 bg-slate-50 border border-slate-300 rounded-lg focus:ring-2 focus:ring-blue-500 outline-none transition-all" placeholder="Ex: 10000">
                        </div>
                        <div>
                            <label class="block text-sm font-semibold text-slate-700 mb-2">N√∫mero a subtrair:</label>
                            <input type="number" id="subtraendo" value="4362" class="w-full p-3 bg-slate-50 border border-slate-300 rounded-lg focus:ring-2 focus:ring-blue-500 outline-none transition-all" placeholder="Ex: 4362">
                        </div>
                    </div>
                    
                    <div class="flex gap-3 mt-6">
                        <button onclick="calcular()" class="flex-1 bg-blue-600 hover:bg-blue-700 text-white font-bold py-3 rounded-xl transition-colors shadow-lg shadow-blue-200">
                            Calcular
                        </button>
                        <button onclick="salvarExemplo()" class="bg-emerald-100 hover:bg-emerald-200 text-emerald-700 font-bold px-6 py-3 rounded-xl transition-colors">
                            Guardar Exemplo
                        </button>
                    </div>
                </div>

                <!-- Painel de Resultados -->
                <div id="resultado-container" class="hidden space-y-8 animate-fade">
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                        <div class="bg-red-50 p-6 rounded-2xl border border-red-100">
                            <h3 class="text-red-700 font-bold mb-4 flex items-center italic">‚ùå M√©todo Tradicional</h3>
                            <div id="subtracao-original" class="math-font text-2xl text-center whitespace-pre leading-relaxed text-red-900"></div>
                            <p class="text-xs text-red-600 mt-4 text-center">Requer "pedir emprestado" m√∫ltiplas vezes.</p>
                        </div>

                        <div class="bg-green-50 p-6 rounded-2xl border border-green-100">
                            <h3 class="text-green-700 font-bold mb-4 flex items-center italic">‚úÖ M√©todo F√°cil (-1)</h3>
                            <div id="subtracao-facil" class="math-font text-2xl text-center whitespace-pre leading-relaxed text-green-900"></div>
                            <p class="text-xs text-green-600 mt-4 text-center">Subtra√ß√£o direta, d√≠gito a d√≠gito!</p>
                        </div>
                    </div>

                    <!-- Representa√ß√£o Visual -->
                    <div class="bg-white p-6 rounded-2xl shadow-sm border border-slate-200">
                        <h3 class="font-bold text-slate-800 mb-4 text-center text-sm uppercase tracking-wide">L√≥gica da Dist√¢ncia Constante</h3>
                        <div class="overflow-x-auto py-8">
                            <svg id="linha" width="700" height="220" viewBox="0 0 700 220" class="mx-auto"></svg>
                        </div>
                        <p id="texto-explicativo" class="mt-4 text-slate-500 text-center italic text-sm px-4"></p>
                    </div>
                </div>
            </div>

            <!-- Caderno de Exemplos -->
            <div class="lg:col-span-1">
                <div class="bg-white rounded-2xl shadow-sm border border-slate-200 p-6 sticky top-8">
                    <h2 class="text-lg font-bold text-slate-900 mb-4 flex items-center gap-2">
                        <span>üìì</span> Os Meus Exemplos
                    </h2>
                    <div id="lista-exemplos" class="space-y-3 max-h-[500px] overflow-y-auto pr-2">
                        <p class="text-slate-400 text-sm text-center py-8">Ainda n√£o guardou exemplos.</p>
                    </div>
                </div>
            </div>

        </div>
    </div>

    <script>
        let exemplosSalvos = [];

        // Mant√©m n√∫meros sem pontos para alinhamento vertical perfeito
        function formatarNumero(n) {
            return n.toString();
        }

        function validarEntrada(potencia, subtraendo) {
            if (isNaN(potencia) || potencia <= 0 || isNaN(subtraendo) || subtraendo <= 0) {
                alert("Introduza valores positivos v√°lidos.");
                return false;
            }
            if (subtraendo >= potencia) {
                alert(`O n√∫mero a subtrair deve ser menor que a base (${potencia}).`);
                return false;
            }
            return true;
        }

        function calcular() {
            const potencia = parseInt(document.getElementById("potencia").value);
            const subtraendo = parseInt(document.getElementById("subtraendo").value);

            if (!validarEntrada(potencia, subtraendo)) {
                document.getElementById("resultado-container").classList.add("hidden");
                return;
            }

            const m1 = potencia - 1;
            const s1 = subtraendo - 1;
            const res = potencia - subtraendo;

            // Interface
            document.getElementById("resultado-container").classList.remove("hidden");
            
            const pStr = formatarNumero(potencia);
            const sStr = formatarNumero(subtraendo);
            const m1Str = formatarNumero(m1);
            const s1Str = formatarNumero(s1);
            const resStr = formatarNumero(res);

            const largura = Math.max(pStr.length, sStr.length, resStr.length) + 2;
            
            const formatView = (a, b, resShow = "") => {
                return a.padStart(largura) + "\n- " + b.padStart(largura - 2) + "\n" + "‚Äî".repeat(largura) + (resShow ? "\n" + resShow.padStart(largura) : "");
            };

            document.getElementById("subtracao-original").textContent = formatView(pStr, sStr, "?");
            document.getElementById("subtracao-facil").textContent = formatView(m1Str, s1Str, resStr);

            document.getElementById("texto-explicativo").innerHTML = 
                `Ao retirar 1 unidade a ambos os n√∫meros, a <strong>dist√¢ncia</strong> entre eles mant√©m-se igual, mas eliminamos a necessidade de pedir emprestado.`;

            desenharReta(s1, subtraendo, m1, potencia, res);
            
            // Evento Analytics (Opcional: rastrear c√°lculos efetuados)
            if (typeof gtag === 'function') {
                gtag('event', 'calculo_realizado', {
                    'base': potencia,
                    'subtraendo': subtraendo
                });
            }
        }

        function salvarExemplo() {
            const pot = parseInt(document.getElementById("potencia").value);
            const sub = parseInt(document.getElementById("subtraendo").value);
            
            if (!validarEntrada(pot, sub)) return;

            const novo = { id: Date.now(), pot, sub, res: pot - sub };
            
            // Evita duplicados
            if (exemplosSalvos.length > 0 && exemplosSalvos[0].pot == pot && exemplosSalvos[0].sub == sub) return;

            exemplosSalvos.unshift(novo);
            renderizarLista();
            calcular();
        }

        function renderizarLista() {
            const lista = document.getElementById("lista-exemplos");
            if (exemplosSalvos.length === 0) {
                lista.innerHTML = `<p class="text-slate-400 text-sm text-center py-8">Ainda n√£o guardou exemplos.</p>`;
                return;
            }

            lista.innerHTML = exemplosSalvos.map((ex, idx) => `
                <div class="p-3 bg-slate-50 border border-slate-200 rounded-xl flex justify-between items-center group animate-fade">
                    <div class="text-sm">
                        <div class="text-[10px] font-bold text-slate-400 uppercase tracking-tighter">Exemplo #${exemplosSalvos.length - idx}</div>
                        <div class="font-mono text-slate-700">${ex.pot} - ${ex.sub} = <span class="text-blue-600 font-bold">${ex.res}</span></div>
                    </div>
                    <div class="flex gap-2">
                        <button onclick="carregarExemplo(${ex.pot}, ${ex.sub})" class="p-1.5 hover:bg-blue-100 text-blue-600 rounded">üëÅÔ∏è</button>
                        <button onclick="excluirExemplo(${ex.id})" class="p-1.5 hover:bg-red-100 text-red-600 rounded">üóëÔ∏è</button>
                    </div>
                </div>
            `).join('');
        }

        function carregarExemplo(pot, sub) {
            document.getElementById("potencia").value = pot;
            document.getElementById("subtraendo").value = sub;
            calcular();
        }

        function excluirExemplo(id) {
            exemplosSalvos = exemplosSalvos.filter(ex => ex.id !== id);
            renderizarLista();
        }

        function desenharReta(s1, s0, m1, m0, dist) {
            const svg = document.getElementById("linha");
            svg.innerHTML = "";
            const pad = 60, w = 700 - 2 * pad, y = 110; 
            const getX = (val) => pad + (val / m0) * w;
            const pS1 = getX(s1), pS0 = getX(s0), pM1 = getX(m1), pM0 = getX(m0);

            svg.innerHTML += `<line x1="${pad}" y1="${y}" x2="${pad+w}" y2="${y}" stroke="#cbd5e1" stroke-width="2"/>`;
            
            const pt = (x, label, color, off, isTop) => `
                <circle cx="${x}" cy="${y}" r="5" fill="${color}"/>
                <text x="${x}" y="${isTop ? y - off : y + off}" text-anchor="middle" font-size="11" fill="${color}" font-weight="bold">${label}</text>
            `;

            svg.innerHTML += pt(pS1, s1, "#16a34a", 15, true);
            svg.innerHTML += pt(pM1, m1, "#16a34a", 15, true);
            svg.innerHTML += pt(pS0, s0, "#2563eb", 25, false);
            svg.innerHTML += pt(pM0, m0, "#2563eb", 25, false);

            const arc = (x1, x2, color, label, h) => `
                <path d="M ${x1} ${y-10} Q ${(x1+x2)/2} ${y-h} ${x2} ${y-10}" stroke="${color}" fill="none" stroke-width="2" stroke-dasharray="4" marker-end="url(#seta)"/>
                <text x="${(x1+x2)/2}" y="${y-h-5}" text-anchor="middle" font-size="12" fill="${color}" font-weight="bold">${label}</text>
            `;

            svg.innerHTML += `<defs><marker id="seta" markerWidth="10" markerHeight="10" refX="0" refY="3" orient="auto"><path d="M0,0 L0,6 L9,3 z" fill="context-stroke"/></marker></defs>`;
            svg.innerHTML += arc(pS1, pM1, "#16a34a", "Resultado: " + dist, 80);
            svg.innerHTML += arc(pS0, pM0, "#2563eb", "Mesma Dist√¢ncia", 45);
        }

        window.onload = calcular;
    </script>
</body>
</html>

