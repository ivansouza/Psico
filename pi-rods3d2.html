<!DOCTYPE html>
<html lang="pt-PT">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Visualização 3D de Pi - Design Minimalista</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body { margin: 0; overflow: hidden; font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif; }
        canvas { display: block; }
        .glass {
            background: rgba(15, 23, 42, 0.85);
            backdrop-filter: blur(16px);
            border: 1px solid rgba(255, 255, 255, 0.1);
            box-shadow: 0 8px 32px 0 rgba(0, 0, 0, 0.6);
        }
        .settings-panel {
            transition: transform 0.4s cubic-bezier(0.16, 1, 0.3, 1), opacity 0.3s ease;
        }
        .settings-hidden {
            transform: translateX(-120%);
            opacity: 0;
            pointer-events: none;
        }
    </style>
</head>
<body class="bg-slate-950 text-white">

    <!-- Botão de Configurações -->
    <button id="toggleSettings" class="fixed top-6 left-6 z-50 p-4 rounded-full glass hover:bg-slate-800 transition-all active:scale-90 group" title="Configurações">
        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="text-purple-400 group-hover:rotate-90 transition-transform duration-700">
            <path d="M12.22 2h-.44a2 2 0 0 0-2 2 2 2 0 0 1-2 2 2 2 0 0 0-2 2 2 2 0 0 1-2 2 2 2 0 0 0-2 2v.44a2 2 0 0 0 2 2 2 2 0 0 1 2 2 2 2 0 0 0 2 2 2 2 0 0 1 2 2 2 2 0 0 0 2 2h.44a2 2 0 0 0 2-2 2 2 0 0 1 2-2 2 2 0 0 0 2-2 2 2 0 0 1 2-2 2 2 0 0 0 2-2v-.44a2 2 0 0 0-2-2 2 2 0 0 1-2-2 2 2 0 0 0-2-2 2 2 0 0 1-2-2 2 2 0 0 0-2-2z"></path>
            <circle cx="12" cy="12" r="3"></circle>
        </svg>
    </button>

    <!-- Painel Lateral -->
    <div id="settingsPanel" class="fixed top-24 left-6 z-40 space-y-4 w-72 sm:w-80 settings-panel settings-hidden">
        <div class="glass p-6 rounded-3xl">
            <h1 class="text-xl font-bold mb-1 text-purple-400">Escultura de π 3D</h1>
            <p class="text-[11px] text-slate-400 mb-6 leading-relaxed">
                As duas hastes partilham agora uma estética uniforme e minimalista, focando a atenção na complexidade da trajetória irracional.
            </p>
            
            <div class="space-y-6">
                <div>
                    <div class="flex justify-between mb-2">
                        <label class="text-[10px] font-black uppercase tracking-widest text-slate-500">Velocidade</label>
                        <span id="speedVal" class="text-xs font-mono text-purple-400">0.50</span>
                    </div>
                    <input id="speedRange" type="range" min="0" max="2" step="0.01" value="0.5" class="w-full h-1.5 bg-slate-700 rounded-lg appearance-none cursor-pointer accent-purple-500">
                </div>

                <div>
                    <div class="flex justify-between mb-2">
                        <label class="text-[10px] font-black uppercase tracking-widest text-slate-500">Comprimento</label>
                        <span id="lenVal" class="text-xs font-mono text-cyan-400">5.0</span>
                    </div>
                    <input id="lenRange" type="range" min="1" max="10" step="0.1" value="5" class="w-full h-1.5 bg-slate-700 rounded-lg appearance-none cursor-pointer accent-cyan-400">
                </div>

                <div class="flex flex-col gap-2 pt-2">
                    <button id="resetTrail" class="w-full bg-red-500/20 hover:bg-red-500/40 text-red-400 text-[10px] font-bold py-3 rounded-xl transition-all uppercase tracking-widest border border-red-500/30">
                        Limpar Trajetória
                    </button>
                    <button id="resetCam" class="w-full bg-slate-800 hover:bg-slate-700 text-white text-[10px] font-bold py-3 rounded-xl transition-all uppercase tracking-widest">
                        Resetar Visão
                    </button>
                </div>
            </div>
        </div>

        <div class="glass p-4 rounded-2xl text-[10px] text-slate-400 space-y-2">
            <div class="flex items-center gap-2">
                <div class="w-2 h-2 rounded-full bg-cyan-500"></div>
                <span>Haste Base (Eixo Z): ω</span>
            </div>
            <div class="flex items-center gap-2">
                <div class="w-2 h-2 rounded-full bg-purple-400"></div>
                <span>Haste Secundária (Eixo X): π · ω</span>
            </div>
            <p class="pt-2 border-t border-white/5 text-slate-500 italic text-center text-[9px]">A razão π garante que o rastro nunca se sobrepõe perfeitamente.</p>
        </div>
    </div>

    <div class="fixed bottom-6 left-6 z-10 glass px-4 py-2 rounded-xl text-[9px] font-mono text-slate-400">
        PONTOS NO ESPAÇO: <span id="pointCount" class="text-purple-400">0</span>
    </div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/three@0.128.0/examples/js/controls/OrbitControls.js"></script>

    <script>
        let scene, camera, renderer, controls;
        let pivot1, pivot2, rod1, rod2, tip;
        let jointSphere, tipSphere;
        let trail, trailGeometry;
        
        const MAX_POINTS = 2000000; 
        let pointsArray = new Float32Array(MAX_POINTS * 3); 
        let pointsCount = 0;
        let clock = new THREE.Clock();
        
        let angle1 = 0; 
        let angle2 = 0; 
        
        // Configuração com espessura uniforme e sem shaders listrados
        const config = {
            omega: 0.5,
            L: 5.0,
            subSteps: 25,
            radius: 0.12
        };

        function init() {
            scene = new THREE.Scene();
            scene.background = new THREE.Color(0x020617);

            camera = new THREE.PerspectiveCamera(60, window.innerWidth / window.innerHeight, 0.1, 2000);
            camera.position.set(20, 15, 25);

            renderer = new THREE.WebGLRenderer({ antialias: true });
            renderer.setSize(window.innerWidth, window.innerHeight);
            renderer.setPixelRatio(Math.min(window.devicePixelRatio, 2));
            document.body.appendChild(renderer.domElement);

            scene.add(new THREE.AmbientLight(0xffffff, 0.3));
            const l1 = new THREE.PointLight(0xa855f7, 2, 100);
            l1.position.set(20, 30, 20);
            scene.add(l1);

            const l2 = new THREE.PointLight(0x06b6d4, 1.5, 100);
            l2.position.set(-20, -10, -15);
            scene.add(l2);

            controls = new THREE.OrbitControls(camera, renderer.domElement);
            controls.enableDamping = true;

            // Materiais Standard para um aspeto metálico limpo
            const baseMat = new THREE.MeshStandardMaterial({ 
                color: 0x06b6d4, 
                metalness: 0.9, 
                roughness: 0.1,
                emissive: 0x083344, 
                emissiveIntensity: 0.2
            });

            const secondaryMat = new THREE.MeshStandardMaterial({ 
                color: 0xa855f7, 
                metalness: 0.9, 
                roughness: 0.1,
                emissive: 0x3b0764, 
                emissiveIntensity: 0.2
            });

            // 1. Pivot Central (Base)
            pivot1 = new THREE.Group();
            scene.add(pivot1);

            // Esfera na Origem
            const sphereGeo = new THREE.SphereGeometry(config.radius * 1.5, 24, 24);
            const originSphere = new THREE.Mesh(sphereGeo, baseMat);
            pivot1.add(originSphere);

            // Haste 1 (Base)
            const geo1 = new THREE.CylinderGeometry(config.radius, config.radius, 1, 16);
            geo1.translate(0, 0.5, 0); 
            rod1 = new THREE.Mesh(geo1, baseMat);
            pivot1.add(rod1);
            rod1.scale.y = config.L;

            // 2. Pivot Intermédio (Articulação)
            pivot2 = new THREE.Group();
            pivot2.position.y = config.L;
            pivot1.add(pivot2);

            // Esfera de Junção
            const jointGeo = new THREE.SphereGeometry(config.radius * 1.5, 24, 24);
            jointSphere = new THREE.Mesh(jointGeo, secondaryMat);
            pivot2.add(jointSphere);

            // Haste 2 (Secundária)
            const geo2 = new THREE.CylinderGeometry(config.radius, config.radius, 1, 32);
            geo2.translate(0, 0.5, 0); 
            rod2 = new THREE.Mesh(geo2, secondaryMat);
            pivot2.add(rod2);
            rod2.scale.y = config.L;

            // 3. Ponta (Tip)
            const tipGeo = new THREE.SphereGeometry(config.radius * 1.5, 16, 16);
            tipSphere = new THREE.Mesh(tipGeo, secondaryMat);
            tipSphere.position.y = config.L;
            pivot2.add(tipSphere);

            tip = tipSphere; 

            // Rastro
            trailGeometry = new THREE.BufferGeometry();
            trailGeometry.setAttribute('position', new THREE.BufferAttribute(pointsArray, 3));
            const trailMat = new THREE.LineBasicMaterial({ 
                color: 0xf472b6, 
                transparent: true, 
                opacity: 0.4, 
                blending: THREE.AdditiveBlending
            });
            trail = new THREE.Line(trailGeometry, trailMat);
            trail.frustumCulled = false;
            scene.add(trail);

            setupUI();
            window.addEventListener('resize', onResize);
            animate();
        }

        function setupUI() {
            const panel = document.getElementById('settingsPanel');
            const toggle = document.getElementById('toggleSettings');
            toggle.addEventListener('click', () => panel.classList.toggle('settings-hidden'));

            document.getElementById('speedRange').addEventListener('input', (e) => {
                config.omega = parseFloat(e.target.value);
                document.getElementById('speedVal').textContent = config.omega.toFixed(2);
            });

            document.getElementById('lenRange').addEventListener('input', (e) => {
                const newL = parseFloat(e.target.value);
                config.L = newL;
                document.getElementById('lenVal').textContent = newL.toFixed(1);
                rod1.scale.y = newL;
                rod2.scale.y = newL;
                pivot2.position.y = newL;
                tipSphere.position.y = newL;
            });

            document.getElementById('resetTrail').addEventListener('click', () => {
                pointsCount = 0;
                trailGeometry.setDrawRange(0, 0);
                document.getElementById('pointCount').textContent = "0";
            });

            document.getElementById('resetCam').addEventListener('click', () => {
                camera.position.set(20, 15, 25);
                controls.target.set(0, 0, 0);
            });
        }

        function onResize() {
            camera.aspect = window.innerWidth / window.innerHeight;
            camera.updateProjectionMatrix();
            renderer.setSize(window.innerWidth, window.innerHeight);
        }

        function animate() {
            requestAnimationFrame(animate);
            const delta = clock.getDelta();
            const subDelta = delta / config.subSteps;

            if (config.omega > 0) {
                for (let i = 0; i < config.subSteps; i++) {
                    angle1 += config.omega * subDelta;
                    angle2 += Math.PI * config.omega * subDelta;

                    pivot1.rotation.z = angle1;
                    pivot2.rotation.x = angle2;

                    pivot1.updateMatrixWorld(true);
                    pivot2.updateMatrixWorld(true);

                    const pos = new THREE.Vector3();
                    tip.getWorldPosition(pos);
                    
                    if (pointsCount < MAX_POINTS) {
                        const idx = pointsCount * 3;
                        pointsArray[idx] = pos.x;
                        pointsArray[idx + 1] = pos.y;
                        pointsArray[idx + 2] = pos.z;
                        pointsCount++;
                    }
                }
                trailGeometry.attributes.position.needsUpdate = true;
                trailGeometry.setDrawRange(0, pointsCount);
                document.getElementById('pointCount').textContent = pointsCount.toLocaleString();
            }

            controls.update();
            renderer.render(scene, camera);
        }

        window.onload = init;
    </script>
</body>
</html>

