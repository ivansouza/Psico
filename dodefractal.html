<!DOCTYPE html>
<html lang="pt-PT">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dodecaedro Sagrado - Customizador Avançado</title>
    <style>
        body { margin: 0; overflow: hidden; background-color: #000; font-family: 'Segoe UI', system-ui, sans-serif; }
        canvas { display: block; }
        
        /* Ícone da Engrenagem */
        #settings-btn {
            position: absolute;
            top: 20px;
            right: 20px;
            width: 40px;
            height: 40px;
            cursor: pointer;
            z-index: 100;
            fill: #0044ff;
            filter: drop-shadow(0 0 10px #0022aa);
            transition: transform 0.3s ease, fill 0.3s ease;
        }
        #settings-btn:hover { transform: rotate(90deg); fill: #00d2ff; }

        /* Janela Transparente (Glassmorphism) */
        #settings-panel {
            position: absolute;
            top: 70px;
            right: 20px;
            width: 280px;
            background: rgba(0, 5, 15, 0.85);
            backdrop-filter: blur(15px);
            -webkit-backdrop-filter: blur(15px);
            border: 1px solid rgba(0, 102, 255, 0.3);
            border-radius: 15px;
            padding: 20px;
            color: #00d2ff;
            box-shadow: 0 8px 32px 0 rgba(0, 0, 0, 0.9);
            display: none; 
            z-index: 90;
            user-select: none;
            max-height: 80vh;
            overflow-y: auto;
        }
        #settings-panel.active { display: block; animation: fadeIn 0.3s ease; }

        @keyframes fadeIn { from { opacity: 0; transform: translateY(-10px); } to { opacity: 1; transform: translateY(0); } }

        h2 { margin: 0 0 15px 0; font-size: 14px; text-transform: uppercase; letter-spacing: 2px; text-align: center; border-bottom: 1px solid rgba(0, 102, 255, 0.2); padding-bottom: 10px; }

        .control-group { margin-bottom: 15px; }
        .control-row { display: flex; align-items: center; justify-content: space-between; gap: 10px; }
        label { display: block; font-size: 11px; margin-bottom: 5px; opacity: 0.8; }
        
        input[type="range"] {
            width: 100%;
            cursor: pointer;
            accent-color: #0066ff;
            background: rgba(0, 102, 255, 0.1);
            border-radius: 5px;
            height: 4px;
            -webkit-appearance: none;
        }

        input[type="color"] {
            border: none;
            width: 30px;
            height: 30px;
            cursor: pointer;
            background: none;
            padding: 0;
        }

        #ui-hint {
            position: absolute;
            bottom: 20px;
            left: 20px;
            color: #0044ff;
            pointer-events: none;
            text-transform: uppercase;
            letter-spacing: 2px;
            font-size: 10px;
            opacity: 0.6;
        }
    </style>
</head>
<body>
    <div id="ui-hint">Gire para explorar • Role para zoom</div>

    <svg id="settings-btn" viewBox="0 0 24 24" onclick="togglePanel()">
        <path d="M12 15a3 3 0 100-6 3 3 0 000 6z" />
        <path d="M19.4 15a1.65 1.65 0 00.33 1.82l.06.06a2 2 0 010 2.83 2 2 0 01-2.83 0l-.06-.06a1.65 1.65 0 00-1.82-.33 1.65 1.65 0 00-1 1.51V21a2 2 0 01-2 2 2 2 0 01-2-2v-.09A1.65 1.65 0 009 19.4a1.65 1.65 0 00-1.82.33l-.06.06a2 2 0 01-2.83 0 2 2 0 010-2.83l.06-.06a1.65 1.65 0 00.33-1.82 1.65 1.65 0 00-1.51-1H3a2 2 0 01-2-2 2 2 0 012-2h.09A1.65 1.65 0 004.6 9a1.65 1.65 0 00-.33-1.82l-.06-.06a2 2 0 010-2.83 2 2 0 012.83 0l.06.06a1.65 1.65 0 001.82.33H9a1.65 1.65 0 001-1.51V3a2 2 0 012-2 2 2 0 012 2v.09a1.65 1.65 0 001 1.51 1.65 1.65 0 001.82-.33l.06-.06a2 2 0 012.83 0 2 2 0 010 2.83l-.06.06a1.65 1.65 0 00-.33 1.82V9a1.65 1.65 0 001.51 1H21a2 2 0 012 2 2 2 0 01-2 2h-.09a1.65 1.65 0 00-1.51 1z" />
    </svg>

    <div id="settings-panel">
        <h2>Ajustes Mandala</h2>
        
        <div class="control-group">
            <label>Cores</label>
            <div class="control-row">
                <input type="color" id="param-color1" value="#000033">
                <input type="color" id="param-color2" value="#00d2ff">
            </div>
        </div>

        <div class="control-group">
            <label>Velocidade das Mandalas (Giro)</label>
            <input type="range" id="param-mandala-speed" min="0" max="4" step="0.1" value="1.5">
        </div>

        <div class="control-group">
            <label>Velocidade do Caleidoscópio (Fractal)</label>
            <input type="range" id="param-kaleido-speed" min="0" max="4" step="0.1" value="1.0">
        </div>

        <div class="control-group">
            <label>Velocidade de Transmutação (Ondas)</label>
            <input type="range" id="param-speed" min="0" max="4" step="0.1" value="2.5">
        </div>

        <div class="control-group">
            <label>Complexidade Fractal</label>
            <input type="range" id="param-complexity" min="1" max="5" step="1" value="3">
        </div>

        <div class="control-group">
            <label>Intensidade de Luz (Glow)</label>
            <input type="range" id="param-glow" min="0.1" max="2.0" step="0.05" value="1.0">
        </div>
        
        <div class="control-group">
            <label>Escala (Preenchimento)</label>
            <input type="range" id="param-scale" min="1" max="4" step="0.1" value="1.9">
        </div>
        
        <div class="control-group">
            <label>Simetria (Lados)</label>
            <input type="range" id="param-slices" min="3" max="15" step="1" value="5">
        </div>
        
        <div class="control-group">
            <label>Velocidade do Objeto (Giro 3D)</label>
            <input type="range" id="param-rot" min="0" max="3" step="0.1" value="1.2">
        </div>
    </div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/three@0.128.0/examples/js/controls/OrbitControls.js"></script>

    <script id="vertexShader" type="x-shader/x-vertex">
        varying vec3 vNormal;
        varying vec3 vLocalPos;
        
        void main() {
            vNormal = normalize(normal);
            vLocalPos = position;
            gl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);
        }
    </script>

    <script id="fragmentShader" type="x-shader/x-fragment">
        uniform float u_time;
        uniform float u_mandala_time;
        uniform float u_kaleido_time;
        uniform float u_complexity;
        uniform float u_glow;
        uniform float u_scale;
        uniform float u_slices;
        uniform vec3 u_color1; 
        uniform vec3 u_color2; 
        
        varying vec3 vNormal;
        varying vec3 vLocalPos;

        #define PI 3.14159265359

        vec3 getPalette(float t) {
            vec3 black = vec3(0.0, 0.0, 0.0);
            vec3 col = mix(black, u_color1, smoothstep(0.0, 0.5, t));
            col = mix(col, u_color2, smoothstep(0.3, 1.0, t));
            return col;
        }

        void main() {
            vec3 normal = normalize(vNormal);
            
            vec3 helper = abs(normal.y) < 0.99 ? vec3(0.0, 1.0, 0.0) : vec3(1.0, 0.0, 0.0);
            vec3 tangent = normalize(cross(normal, helper));
            vec3 bitangent = cross(normal, tangent);
            
            vec2 uv = vec2(dot(vLocalPos, tangent), dot(vLocalPos, bitangent));
            uv *= u_scale; 
            vec2 uv0 = uv;
            
            vec3 finalColor = vec3(0.0);

            for (float i = 0.0; i < 5.0; i++) {
                if (i >= u_complexity) break;

                // u_mandala_time controla a rotação angular das fatias
                float a = atan(uv.y, uv.x) + u_mandala_time * (0.3 + i * 0.15);
                float r = length(uv);
                float sliceSize = (2.0 * PI) / u_slices;
                float foldA = mod(a, sliceSize) - sliceSize * 0.5;
                foldA = abs(foldA);
                
                uv = vec2(cos(foldA), sin(foldA)) * r;
                // u_kaleido_time controla a pulsação da escala fractal
                uv = fract(uv * (1.5 + 0.2 * sin(u_kaleido_time * 0.4))) - 0.5;
                
                float d = length(uv) * exp(-length(uv0));
                vec3 col = getPalette(fract(length(uv0) * 0.5 + i * 0.2));
                
                // u_time controla as ondas de transmutação
                d = sin(d * 12.0 - u_time * 3.0) / 12.0; 
                d = abs(d);
                
                d = pow(0.012 * u_glow / d, 1.1);
                
                finalColor += col * d;
            }

            float r0 = length(uv0);
            for(float j = 1.0; j <= 2.0; j++) {
                float ring = smoothstep(0.03, 0.0, abs(r0 - j * 0.18) - 0.01 * sin(u_time * 6.0));
                finalColor += u_color1 * ring * (0.8 / j);
            }
            
            finalColor += u_color2 * smoothstep(0.09, 0.0, r0) * 1.5;
            finalColor *= smoothstep(1.5, 0.5, r0) * 0.5 + 0.5;

            gl_FragColor = vec4(clamp(finalColor, 0.0, 1.0), 1.0);
        }
    </script>

    <script>
        let panelOpen = false;
        function togglePanel() {
            panelOpen = !panelOpen;
            document.getElementById('settings-panel').classList.toggle('active', panelOpen);
        }

        function hexToRgb(hex) {
            const r = parseInt(hex.slice(1, 3), 16) / 255;
            const g = parseInt(hex.slice(3, 5), 16) / 255;
            const b = parseInt(hex.slice(5, 7), 16) / 255;
            return new THREE.Vector3(r, g, b);
        }

        window.onload = function() {
            const scene = new THREE.Scene();
            const camera = new THREE.PerspectiveCamera(45, window.innerWidth / window.innerHeight, 0.1, 1000);
            camera.position.set(0, 0, 5);

            const renderer = new THREE.WebGLRenderer({ antialias: true });
            renderer.setSize(window.innerWidth, window.innerHeight);
            renderer.setPixelRatio(Math.min(window.devicePixelRatio, 2));
            document.body.appendChild(renderer.domElement);

            const controls = new THREE.OrbitControls(camera, renderer.domElement);
            controls.enableDamping = true;
            controls.dampingFactor = 0.08;

            const geometry = new THREE.DodecahedronGeometry(1.6, 0);

            const uniforms = {
                u_time: { value: 0.0 },
                u_mandala_time: { value: 0.0 },
                u_kaleido_time: { value: 0.0 },
                u_complexity: { value: 3.0 },
                u_glow: { value: 1.0 },
                u_scale: { value: 1.9 },
                u_slices: { value: 5.0 },
                u_color1: { value: new THREE.Vector3() },
                u_color2: { value: new THREE.Vector3() }
            };

            const material = new THREE.ShaderMaterial({
                uniforms: uniforms,
                vertexShader: document.getElementById('vertexShader').textContent,
                fragmentShader: document.getElementById('fragmentShader').textContent,
                side: THREE.FrontSide
            });

            const mesh = new THREE.Mesh(geometry, material);
            scene.add(mesh);

            let lastTime = 0;
            let accTime = 0;
            let accMandalaTime = 0;
            let accKaleidoTime = 0;

            function animate(now) {
                requestAnimationFrame(animate);
                
                const deltaTime = (now - lastTime) * 0.001;
                lastTime = now;

                const speed = parseFloat(document.getElementById('param-speed').value);
                const mandalaSpeed = parseFloat(document.getElementById('param-mandala-speed').value);
                const kaleidoSpeed = parseFloat(document.getElementById('param-kaleido-speed').value);
                const rotBase = parseFloat(document.getElementById('param-rot').value);
                const col1 = document.getElementById('param-color1').value;
                const col2 = document.getElementById('param-color2').value;
                
                uniforms.u_complexity.value = parseFloat(document.getElementById('param-complexity').value);
                uniforms.u_glow.value = parseFloat(document.getElementById('param-glow').value);
                uniforms.u_scale.value = parseFloat(document.getElementById('param-scale').value);
                uniforms.u_slices.value = parseFloat(document.getElementById('param-slices').value);
                uniforms.u_color1.value.copy(hexToRgb(col1));
                uniforms.u_color2.value.copy(hexToRgb(col2));

                // Acumuladores de tempo independentes
                accTime += deltaTime * speed;
                accMandalaTime += deltaTime * mandalaSpeed;
                accKaleidoTime += deltaTime * kaleidoSpeed;
                
                uniforms.u_time.value = accTime;
                uniforms.u_mandala_time.value = accMandalaTime;
                uniforms.u_kaleido_time.value = accKaleidoTime;

                // Rotação do Objeto
                const t = now * 0.0004 * rotBase; 
                mesh.rotation.x = Math.sin(t * 0.7) * 0.4 + Math.cos(t * 0.3) * 0.2;
                mesh.rotation.y = Math.sin(t * 0.5) * 0.5 + Math.cos(t * 0.8) * 0.3;
                mesh.rotation.z += 0.002 * rotBase; 

                controls.update();
                renderer.render(scene, camera);
            }

            window.addEventListener('resize', () => {
                camera.aspect = window.innerWidth / window.innerHeight;
                camera.updateProjectionMatrix();
                renderer.setSize(window.innerWidth, window.innerHeight);
            });

            animate(0);
        };
    </script>
</body>
</html>

