<!DOCTYPE html>
<html lang="pt-PT">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Calculadora de Potências: t^t = x</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://unpkg.com/lucide@latest"></script>
  <style>
    .fade-in { animation: fadeIn .4s ease-in-out; }
    @keyframes fadeIn { from {opacity:0; transform:translateY(10px)} to {opacity:1; transform:translateY(0)} }
    .math-font { font-family: 'Cambria Math', 'Times New Roman', serif; }
  </style>
</head>
<body class="bg-slate-50 text-slate-800 min-h-screen flex flex-col items-center py-10 px-4">
  <div class="bg-white rounded-3xl shadow-xl w-full max-w-lg overflow-hidden border border-slate-100 relative">
    <button onclick="toggleLanguage()" class="absolute top-4 right-4 bg-white/20 hover:bg-white/30 text-white text-xs font-bold px-3 py-1.5 rounded-full transition-colors z-10 flex items-center gap-1 backdrop-blur-sm border border-white/20">
      <i data-lucide="globe" class="w-3 h-3"></i>
      <span id="langBtnText">PT</span>
    </button>

    <div class="bg-blue-600 p-6 text-white text-center relative">
      <div class="flex justify-center mb-3"><i data-lucide="calculator" class="w-10 h-10 text-blue-200"></i></div>
      <h1 data-i18n="appTitle" class="text-2xl font-bold tracking-tight">Equation Analyzer</h1>
      <p data-i18n="appDesc" class="text-blue-100 mt-1">Discover the value of <span class='math-font italic text-lg'>t</span> in the equation <span class='math-font italic text-lg'>t<sup>t</sup> = x</span></p>
    </div>

    <div class="p-6">
      <label data-i18n="inputLabel" for="inputX" class="block text-sm font-medium text-slate-600 mb-2">Enter the value of x (e.g., 49):</label>
      <div class="flex gap-3">
        <div class="relative flex-grow">
          <div class="absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none math-font italic text-slate-400 text-lg">x =</div>
          <input type="number" id="inputX" value="49" min="1" step="any" class="block w-full pl-12 pr-4 py-3 bg-slate-50 border border-slate-200 rounded-xl focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-colors text-lg font-medium outline-none" data-i18n-placeholder="inputPlaceholder" placeholder="E.g., 49" />
        </div>
        <button onclick="calcularResultados()" class="bg-blue-600 hover:bg-blue-700 text-white px-6 py-3 rounded-xl font-medium transition-colors shadow-sm flex items-center gap-2">
          <i data-lucide="play" class="w-4 h-4"></i>
          <span data-i18n="btnAnalyze">Analyze</span>
        </button>
      </div>
      <div id="erroMensagem" class="hidden mt-3 text-red-500 text-sm flex items-center gap-1">
        <i data-lucide="alert-circle" class="w-4 h-4"></i>
        <span data-i18n="errorMsg">Please enter a number greater than or equal to 1.</span>
      </div>
    </div>

    <div id="resultadosContainer" class="hidden px-6 pb-6 space-y-4 bg-slate-50/50 border-t border-slate-100 pt-6 fade-in">
      <div class="bg-white p-5 rounded-2xl border border-blue-100 shadow-sm relative overflow-hidden">
        <div class="absolute top-0 right-0 p-4 opacity-5 pointer-events-none"><i data-lucide="cpu" class="w-24 h-24"></i></div>
        <h3 data-i18n="decApproxTitle" class="text-sm font-bold text-blue-600 uppercase tracking-wider mb-1">Decimal Approximation</h3>
        <p data-i18n="decApproxDesc" class="text-slate-500 text-sm mb-3">Calculated in milliseconds using the Newton-Raphson method.</p>
        <div class="text-4xl text-slate-800 math-font flex items-baseline gap-2">
          <span class="italic">t</span><span class="text-2xl text-slate-400">≈</span><span id="resultadoT" class="font-medium text-blue-600">3.2778</span>
        </div>
      </div>

      <div class="bg-white p-5 rounded-2xl border border-emerald-100 shadow-sm relative overflow-hidden">
        <div class="absolute top-0 right-0 p-4 opacity-5 pointer-events-none"><i data-lucide="target" class="w-24 h-24"></i></div>
        <h3 data-i18n="perfectTargetsTitle" class="text-sm font-bold text-emerald-600 uppercase tracking-wider mb-1">Perfect Integer Targets</h3>
        <p data-i18n="perfectTargetsDesc" class="text-slate-500 text-sm mb-4">Your number is between these two exact powers:</p>
        <div class="grid grid-cols-2 gap-4 text-center">
          <div class="bg-emerald-50 rounded-xl p-3 border border-emerald-100">
            <div data-i18n="lowerLimit" class="text-xs text-emerald-600 font-semibold mb-1 uppercase">Lower Limit</div>
            <div id="limiteInferior" class="math-font text-lg text-slate-700">3<sup>3</sup> = 27</div>
          </div>
          <div class="bg-emerald-50 rounded-xl p-3 border border-emerald-100">
            <div data-i18n="upperLimit" class="text-xs text-emerald-600 font-semibold mb-1 uppercase">Upper Limit</div>
            <div id="limiteSuperior" class="math-font text-lg text-slate-700">4<sup>4</sup> = 256</div>
          </div>
        </div>
        <div id="acertoExato" class="hidden mt-4 bg-emerald-100 text-emerald-800 p-3 rounded-lg text-sm text-center font-medium flex items-center justify-center gap-2">
          <i data-lucide="check-circle" class="w-5 h-5"></i><span data-i18n="exactHit">You hit a perfect integer target!</span>
        </div>
      </div>

      <button onclick="toggleProcesso()" class="w-full py-3 text-sm font-medium text-slate-500 hover:text-slate-800 transition-colors flex justify-center items-center gap-2">
        <span data-i18n="viewAlgorithm">View Algorithm iterations</span>
        <i data-lucide="chevron-down" id="iconeSeta" class="w-4 h-4 transition-transform"></i>
      </button>

      <div id="processoContainer" class="hidden mt-2 bg-slate-800 rounded-2xl p-4 text-slate-300 font-mono text-xs overflow-x-auto shadow-inner">
        <table class="w-full text-left border-collapse">
          <thead>
            <tr class="border-b border-slate-600 text-slate-400">
              <th class="py-2 px-2 font-medium" data-i18n="tableCycle">Cycle</th>
              <th class="py-2 px-2 font-medium" data-i18n="tableEst">Estimated value of t</th>
              <th class="py-2 px-2 font-medium" data-i18n="tablePrec">Precision</th>
            </tr>
          </thead>
          <tbody id="tabelaIteracoes"></tbody>
        </table>
      </div>
    </div>
  </div>

  <p data-i18n="footer" class="text-slate-400 text-sm mt-8 max-w-lg text-center">Iterative math allows computers to find exact answers where simple direct formulas don't exist.</p>

  <script>
    const i18n = {
      en: {
        appTitle:"Equation Analyzer", appDesc:"Discover the value of <span class='math-font italic text-lg'>t</span> in the equation <span class='math-font italic text-lg'>t<sup>t</sup> = x</span>",
        inputLabel:"Enter the value of x (e.g., 49):", inputPlaceholder:"E.g., 49", btnAnalyze:"Analyze", errorMsg:"Please enter a number greater than or equal to 1.",
        decApproxTitle:"Decimal Approximation", decApproxDesc:"Calculated in milliseconds using the Newton-Raphson method.",
        perfectTargetsTitle:"Perfect Integer Targets", perfectTargetsDesc:"Your number is between these two exact powers:", lowerLimit:"Lower Limit", upperLimit:"Upper Limit",
        exactHit:"You hit a perfect integer target!", viewAlgorithm:"View Algorithm iterations", tableCycle:"Cycle", tableEst:"Estimated value of t", tablePrec:"Precision",
        footer:"Iterative math allows computers to find exact answers where simple direct formulas don't exist.", exactResult:"Exact"
      },
      pt: {
        appTitle:"Analisador de Equações", appDesc:"Descubra o valor de <span class='math-font italic text-lg'>t</span> na equação <span class='math-font italic text-lg'>t<sup>t</sup> = x</span>",
        inputLabel:"Introduza o valor de x (ex: 49):", inputPlaceholder:"Ex: 49", btnAnalyze:"Analisar", errorMsg:"Por favor, introduza um número maior ou igual a 1.",
        decApproxTitle:"Aproximação Decimal", decApproxDesc:"Calculado em milissegundos pelo método de Newton-Raphson.",
        perfectTargetsTitle:"Alvos Inteiros Perfeitos", perfectTargetsDesc:"O seu número encontra-se entre estas duas potências exatas:", lowerLimit:"Limite Inferior", upperLimit:"Limite Superior",
        exactHit:"Acertou num alvo inteiro perfeito!", viewAlgorithm:"Ver iterações do Algoritmo", tableCycle:"Ciclo", tableEst:"Valor Estimado de t", tablePrec:"Precisão",
        footer:"A matemática iterativa permite aos computadores encontrar respostas exatas onde não existem fórmulas diretas simples.", exactResult:"Exato"
      }
    };

    let currentLang = 'en';

    function applyTranslations() {
      document.querySelectorAll('[data-i18n]').forEach(el => {
        const key = el.getAttribute('data-i18n');
        if (i18n[currentLang][key]) {
          if (key === 'appDesc') el.innerHTML = i18n[currentLang][key];
          else el.innerText = i18n[currentLang][key];
        }
      });
      document.querySelectorAll('[data-i18n-placeholder]').forEach(el => {
        const key = el.getAttribute('data-i18n-placeholder');
        if (i18n[currentLang][key]) el.placeholder = i18n[currentLang][key];
      });
      document.getElementById('langBtnText').innerText = currentLang === 'en' ? 'PT' : 'EN';
      document.documentElement.lang = currentLang;
      lucide.createIcons();
    }

    function toggleLanguage() {
      currentLang = currentLang === 'en' ? 'pt' : 'en';
      applyTranslations();
      if (!document.getElementById('resultadosContainer').classList.contains('hidden')) calcularResultados();
    }

    function calcularResultados() {
      const inputElement = document.getElementById('inputX');
      const erroMensagem = document.getElementById('erroMensagem');
      const resultadosContainer = document.getElementById('resultadosContainer');
      const x = parseFloat(inputElement.value);

      if (isNaN(x) || x < 1) {
        erroMensagem.classList.remove('hidden');
        resultadosContainer.classList.add('hidden');
        return;
      }
      erroMensagem.classList.add('hidden');

      let i = 1, val = 1, encontrouExato = false, baseInferior = 1, baseSuperior = 1;
      while (true) {
        val = Math.pow(i, i);
        if (val === x) { encontrouExato = true; baseInferior = i; baseSuperior = i; break; }
        if (val > x) { baseSuperior = i; baseInferior = i - 1; break; }
        i++;
      }

      document.getElementById('limiteInferior').innerHTML = `${baseInferior}<sup>${baseInferior}</sup> = ${Math.pow(baseInferior, baseInferior)}`;
      document.getElementById('limiteSuperior').innerHTML = `${baseSuperior}<sup>${baseSuperior}</sup> = ${Math.pow(baseSuperior, baseSuperior)}`;
      document.getElementById('acertoExato').classList.toggle('hidden', !encontrouExato);

      let t = (baseInferior + baseSuperior) / 2;
      if (baseInferior === 0) t = 1;
      let tolerancia = 1e-7, diferenca = 1, iteracoesLimite = 30, ciclo = 0;
      let htmlTabela = '';

      while (diferenca > tolerancia && ciclo < iteracoesLimite) {
        const f_t = Math.pow(t, t) - x;
        const f_linha_t = Math.pow(t, t) * (Math.log(t) + 1);
        const t_novo = t - (f_t / f_linha_t);
        if (!Number.isFinite(t_novo) || t_novo <= 0) break;

        diferenca = Math.abs(t_novo - t);
        ciclo++;
        const precisaoStr = diferenca < tolerancia ? i18n[currentLang].exactResult : `Δ ${diferenca.toFixed(6)}`;

        htmlTabela += `<tr class="border-b border-slate-700/50 hover:bg-slate-700/30 transition-colors">
          <td class="py-2 px-2 text-blue-400">#${ciclo}</td>
          <td class="py-2 px-2">${t_novo.toFixed(6)}</td>
          <td class="py-2 px-2 text-slate-500">${precisaoStr}</td>
        </tr>`;

        t = t_novo;
      }

      // Atualizar UI do Newton-Raphson
      document.getElementById('resultadoT').innerText = t.toFixed(5);
      document.getElementById('tabelaIteracoes').innerHTML = htmlTabela;

      // Mostrar os resultados com animação
      resultadosContainer.classList.remove('hidden');
      // Forçar reinício da animação (truque de DOM) apenas na primeira vez
      if (!resultadosContainer.classList.contains('fade-in')) {
        void resultadosContainer.offsetWidth;
        resultadosContainer.classList.add('fade-in');
      }

      applyTranslations();
    }

    function toggleProcesso() {
      const container = document.getElementById('processoContainer');
      const icone = document.getElementById('iconeSeta');

      if (container.classList.contains('hidden')) {
        container.classList.remove('hidden');
        icone.style.transform = 'rotate(180deg)';
      } else {
        container.classList.add('hidden');
        icone.style.transform = 'rotate(0deg)';
      }
    }

    // Permitir usar a tecla Enter no input
    document.getElementById('inputX').addEventListener('keypress', function (e) {
      if (e.key === 'Enter') {
        calcularResultados();
      }
    });

    // Configurar idioma inicial e calcular imediatamente ao carregar a página
    window.onload = function() {
      applyTranslations();
      calcularResultados();
    };
  </script>
</body>
</html>