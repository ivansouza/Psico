<!DOCTYPE html>
<html lang="pt-pt">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>SEABI 3D Studio - Velocidade Máxima</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/three@0.128.0/examples/js/controls/OrbitControls.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/three@0.128.0/examples/js/controls/TransformControls.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/opentype.js@1.3.4/dist/opentype.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/three@0.128.0/examples/js/loaders/TTFLoader.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/three@0.128.0/examples/js/loaders/FontLoader.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/three@0.128.0/examples/js/geometries/TextGeometry.js"></script>
    <style>
        body { margin: 0; overflow: hidden; background-color: #000; font-family: sans-serif; color: white; touch-action: none; }
        canvas { display: block; }
        
        /* Botão de Engrenagem Superior */
        #gear-button {
            position: absolute; top: 15px; right: 15px; z-index: 200;
            background: rgba(0, 0, 0, 0.4); border: 1px solid rgba(0, 212, 255, 0.5);
            color: #00d4ff; border-radius: 50%; width: 44px; height: 44px;
            cursor: pointer; display: flex; align-items: center; justify-content: center;
            transition: all 0.3s; backdrop-filter: blur(5px);
        }
        #gear-button:hover { background: #00d4ff; color: #000; transform: rotate(45deg); }

        /* Painel Lateral de Edição */
        #editor-ui {
            position: absolute; top: 15px; left: 15px; z-index: 100;
            background: rgba(0, 0, 0, 0.85); padding: 15px; border-radius: 8px;
            border: 1px solid #00d4ff; width: 240px; backdrop-filter: blur(10px);
            transition: transform 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275), opacity 0.3s;
            max-height: 80vh; overflow-y: auto;
        }
        #editor-ui.hidden { transform: translateX(-280px); opacity: 0; pointer-events: none; }

        h3 { margin: 0 0 10px 0; font-size: 14px; color: #00d4ff; text-transform: uppercase; letter-spacing: 1px; }
        select, button {
            width: 100%; padding: 8px; margin-bottom: 8px;
            background: #222; color: #fff; border: 1px solid #444; border-radius: 4px;
            cursor: pointer; font-size: 12px;
        }

        /* Slider de Velocidade na Parte Inferior */
        #speed-container {
            position: absolute; bottom: 30px; left: 50%; transform: translateX(-50%);
            z-index: 150; width: 260px; display: flex; flex-direction: column;
            align-items: center; gap: 8px; pointer-events: auto;
        }
        .speed-label { font-size: 10px; color: #00d4ff; text-transform: uppercase; letter-spacing: 2px; opacity: 0.7; }
        
        input[type=range] { -webkit-appearance: none; width: 100%; background: transparent; }
        input[type=range]:focus { outline: none; }
        input[type=range]::-webkit-slider-runnable-track {
            width: 100%; height: 3px; cursor: pointer;
            background: rgba(0, 212, 255, 0.25); border-radius: 2px;
        }
        input[type=range]::-webkit-slider-thumb {
            height: 16px; width: 16px; border-radius: 50%; background: #00d4ff;
            cursor: pointer; -webkit-appearance: none; margin-top: -6.5px;
            box-shadow: 0 0 12px rgba(0, 212, 255, 0.6);
        }

        /* Botão de Exportação */
        #bottom-ui {
            position: absolute; bottom: 85px; left: 50%; transform: translateX(-50%);
            z-index: 100; transition: opacity 0.3s;
        }
        #bottom-ui.hidden { opacity: 0; pointer-events: none; }

        .action-btn {
            background: rgba(0, 212, 255, 0.1); color: #00d4ff; border: 1px solid #00d4ff;
            padding: 10px 20px; font-weight: bold; border-radius: 5px; 
            text-transform: uppercase; font-size: 11px; cursor: pointer; backdrop-filter: blur(5px);
        }

        #loading {
            position: absolute; width: 100%; height: 100%; background: black;
            display: flex; align-items: center; justify-content: center; z-index: 1000;
            color: #00d4ff; letter-spacing: 2px; font-size: 12px;
        }
        #toast {
            position: absolute; top: -100px; left: 50%; transform: translateX(-50%);
            background: #00d4ff; color: #000; padding: 10px 20px; border-radius: 4px;
            font-weight: bold; font-size: 13px; z-index: 300; transition: top 0.5s;
        }
    </style>
</head>
<body>

    <div id="loading">A CONFIGURAR ESTÚDIO EM ALTA VELOCIDADE...</div>
    <div id="toast">Configuração copiada para o clipboard!</div>

    <button id="gear-button">
        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="3"></circle><path d="M19.4 15a1.65 1.65 0 0 0 .33 1.82l.06.06a2 2 0 0 1 0 2.83 2 2 0 0 1-2.83 0l-.06-.06a1.65 1.65 0 0 0-1.82-.33 1.65 1.65 0 0 0-1 1.51V21a2 2 0 0 1-2 2 2 2 0 0 1-2-2v-.09A1.65 1.65 0 0 0 9 19.4a1.65 1.65 0 0 0-1.82.33l-.06.06a2 2 0 0 1-2.83 0 2 2 0 0 1 0-2.83l.06-.06a1.65 1.65 0 0 0 .33-1.82 1.65 1.65 0 0 0-1.51-1H3a2 2 0 0 1-2-2 2 2 0 0 1 2-2h.09A1.65 1.65 0 0 0 4.6 9a1.65 1.65 0 0 0-.33-1.82l-.06-.06a2 2 0 0 1 0-2.83 2 2 0 0 1 2.83 0l.06.06a1.65 1.65 0 0 0 1.82.33H9a1.65 1.65 0 0 0 1-1.51V3a2 2 0 0 1 2-2 2 2 0 0 1 2 2v.09a1.65 1.65 0 0 0 1 1.51 1.65 1.65 0 0 0 1.82-.33l.06-.06a2 2 0 0 1 2.83 0 2 2 0 0 1 0 2.83l-.06.06a1.65 1.65 0 0 0-.33 1.82V9a1.65 1.65 0 0 0 1.51 1H21a2 2 0 0 1 2 2 2 2 0 0 1-2 2h-.09a1.65 1.65 0 0 0-1.51 1z"></path></svg>
    </button>

    <div id="editor-ui" class="hidden">
        <h3>Estúdio SEABI</h3>
        <label style="font-size: 11px;">Mover Elemento:</label>
        <select id="object-selector">
            <option value="none">Nenhum</option>
            <optgroup label="Luzes Base">
                <option value="light_main">Luz Principal</option>
                <option value="light_p1">Luz Ciano (P1)</option>
                <option value="light_p2">Luz Laranja (P2)</option>
            </optgroup>
            <optgroup label="Luzes Extras" id="extra-lights-opt"></optgroup>
            <optgroup label="Geometria">
                <option value="logo_group">Logo Completo</option>
                <option value="globe">Globo</option>
                <option value="text_seabi">Texto SEABI</option>
                <option value="text_desc">Texto Legenda</option>
            </optgroup>
        </select>
        <button id="btn-auto-orbit">Órbita Câmara: ON</button>
    </div>

    <div id="speed-container">
        <div class="speed-label">Velocidade da Órbita</div>
        <!-- VALOR INICIAL NO MÁXIMO (6) -->
        <input type="range" id="orbit-speed-slider" min="0" max="6" step="0.1" value="6">
    </div>

    <div id="bottom-ui" class="hidden">
        <button id="btn-export" class="action-btn">Exportar Estado JSON</button>
    </div>

    <script id="globeVertex" type="x-shader/x-vertex">
        varying vec2 vUv; varying vec3 vNormal;
        void main() {
            vUv = uv; vNormal = normalize(normalMatrix * normal);
            gl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);
        }
    </script>
    <script id="globeFragment" type="x-shader/x-fragment">
        varying vec2 vUv; varying vec3 vNormal;
        void main() {
            float dots = step(0.9, mod(vUv.x * 120.0, 1.0)) * step(0.9, mod(vUv.y * 60.0, 1.0));
            vec3 color = vec3(0.0, 0.6, 1.0);
            float fresnel = pow(1.1 - dot(vNormal, vec3(0.0, 0.0, 1.0)), 2.5);
            gl_FragColor = vec4(color * dots * 3.0 + color * fresnel * 1.5, dots > 0.1 ? 0.95 : 0.15);
        }
    </script>

    <script>
        const config = {
          "camera": {
            "pos": { "x": -18.143573225209284, "y": -2.0909384383930205, "z": -4.6984326910954906 },
            "target": { "x": 0, "y": 0, "z": 0 }
          },
          "lights": {
            "main": { "x": 3.054, "y": -0.605, "z": 15.72 },
            "p1": { "x": 2.978, "y": -1.471, "z": 9 },
            "p2": { "x": -14.057, "y": -1.02, "z": 9.64 },
            "extras": [
              { "id": "extra_1", "color": 16711680, "pos": { "x": -11.25, "y": -0.5, "z": 12 } },
              { "id": "extra_2", "color": 16742144, "pos": { "x": -8.75, "y": 0.762, "z": 11.08 } },
              { "id": "extra_3", "color": 16776960, "pos": { "x": -6.25, "y": 0.864, "z": 9.168 } },
              { "id": "extra_4", "color": 65280, "pos": { "x": -3.75, "y": -0.288, "z": 8.02 } },
              { "id": "extra_5", "color": 65535, "pos": { "x": -1.25, "y": -1.635, "z": 8.693 } },
              { "id": "extra_6", "color": 30719, "pos": { "x": 1.25, "y": -1.938, "z": 10.567 } },
              { "id": "extra_7", "color": 255, "pos": { "x": 3.75, "y": -0.919, "z": 11.92 } },
              { "id": "extra_8", "color": 7799039, "pos": { "x": 6.25, "y": 0.485, "z": 11.508 } },
              { "id": "extra_9", "color": 16711935, "pos": { "x": 8.75, "y": 0.984, "z": 9.709 } },
              { "id": "extra_10", "color": 16711799, "pos": { "x": 11.25, "y": 0.118, "z": 8.178 } }
            ]
          },
          "logo": { "rotY": -31.5998 * (Math.PI / 180) },
          "objects": { "globe": { "x": 0, "y": 0, "z": 0 }, "seabiText": { "x": 0, "y": -0.2, "z": 0 }, "descText": { "x": 0, "y": -1.2, "z": 0 } }
        };

        let scene, camera, renderer, orbit, transform, logoGroup, font;
        let mainLight, p1, p2, extraLights = [];
        let selectableObjects = {};
        let isAutoOrbit = true;
        let uiVisible = false;

        function init() {
            scene = new THREE.Scene();
            camera = new THREE.PerspectiveCamera(40, window.innerWidth / window.innerHeight, 0.1, 1000);
            camera.position.set(config.camera.pos.x, config.camera.pos.y, config.camera.pos.z);

            renderer = new THREE.WebGLRenderer({ antialias: true });
            renderer.setSize(window.innerWidth, window.innerHeight);
            renderer.setPixelRatio(Math.min(window.devicePixelRatio, 2));
            document.body.appendChild(renderer.domElement);

            orbit = new THREE.OrbitControls(camera, renderer.domElement);
            orbit.enableDamping = true;
            orbit.target.set(0, 0, 0);
            orbit.autoRotate = true;
            
            // VELOCIDADE INICIAL MÁXIMA (Invertida para direita->esquerda)
            orbit.autoRotateSpeed = -6.0;

            transform = new THREE.TransformControls(camera, renderer.domElement);
            transform.addEventListener('dragging-changed', (e) => { orbit.enabled = !e.value; });
            scene.add(transform);

            scene.add(new THREE.AmbientLight(0xffffff, 2.0));
            scene.add(new THREE.HemisphereLight(0xffffff, 0x444444, 1.5));

            const gizGeo = new THREE.SphereGeometry(0.12, 12, 12);
            mainLight = createL(config.lights.main, 0xffffff, 15, gizGeo);
            selectableObjects['light_main'] = mainLight;
            p1 = createL(config.lights.p1, 0x00ffff, 12, gizGeo);
            selectableObjects['light_p1'] = p1;
            p2 = createL(config.lights.p2, 0xffaa00, 12, gizGeo);
            selectableObjects['light_p2'] = p2;

            const extraOpt = document.getElementById('extra-lights-opt');
            config.lights.extras.forEach((el, i) => {
                const l = createL(el.pos, el.color, 8, gizGeo);
                const id = `extra_l_${i}`;
                extraLights.push(l);
                selectableObjects[id] = l;
                const o = document.createElement('option');
                o.value = id; o.textContent = `Luz Extra ${i+1}`;
                extraOpt.appendChild(o);
            });

            logoGroup = new THREE.Group();
            logoGroup.rotation.y = config.logo.rotY;
            scene.add(logoGroup);
            selectableObjects['logo_group'] = logoGroup;

            createGeometry();

            new THREE.TTFLoader().load('https://raw.githubusercontent.com/google/fonts/main/ofl/archivo/Archivo%5Bwdth%2Cwght%5D.ttf', (json) => {
                font = new THREE.FontLoader().parse(json);
                addTexts();
                document.getElementById('loading').style.display = 'none';
            });

            setupUI();
            animate();
        }

        function createL(pos, col, intensity, geo) {
            const l = new THREE.PointLight(col, intensity, 50);
            l.position.set(pos.x, pos.y, pos.z);
            const m = new THREE.Mesh(geo, new THREE.MeshBasicMaterial({ color: col }));
            m.visible = false; 
            l.add(m);
            scene.add(l);
            return l;
        }

        function createGeometry() {
            // Globo
            const globe = new THREE.Mesh(new THREE.SphereGeometry(2.8, 64, 64), new THREE.ShaderMaterial({
                vertexShader: document.getElementById('globeVertex').textContent,
                fragmentShader: document.getElementById('globeFragment').textContent,
                transparent: true, side: THREE.DoubleSide
            }));
            logoGroup.add(globe);
            selectableObjects['globe'] = globe;

            // Barras do Gráfico
            const barsCol = [0x00ffff, 0x39ff14, 0xff00ff, 0xffff00];
            const barAngles = [-0.93, -0.31, 0.31, 0.93]; 
            for (let i = 0; i < 4; i++) {
                const h = 1.0 + (i * 0.7);
                const mat = new THREE.MeshStandardMaterial({ color: barsCol[i], metalness: 1, roughness: 0.05, emissive: barsCol[i], emissiveIntensity: 0.5 });
                mat.onBeforeCompile = (s) => {
                    s.uniforms.uR = { value: 2.8 }; s.uniforms.uO = { value: barAngles[i] };
                    s.vertexShader = `uniform float uR; uniform float uO;\n` + s.vertexShader.replace('#include <begin_vertex>', `
                        vec3 pos = position; float r = uR + pos.z; float a = (pos.x * 0.45) + uO;
                        vec3 transformed = vec3(r * sin(a), pos.y, r * cos(a));
                    `);
                };
                const bar = new THREE.Mesh(new THREE.BoxGeometry(1.35, h, 0.45, 30, 1, 1), mat);
                bar.position.y = h/2 - 0.2; logoGroup.add(bar);
            }

            // --- SETA AMARELA INTELIGENTE ---
            const arrowPts = [];
            const segments = 100;
            const bar2Angle = -0.15; 

            for(let i=0; i<=segments; i++){
                const t = i/segments;
                let r, angle, y;
                angle = (t - 0.4) * 2.8; 

                if (angle < bar2Angle) {
                    r = 3.2; 
                    y = (t * 2.0) - 1.2;
                } else {
                    const transitionT = (angle - bar2Angle) / 1.5;
                    r = 3.2 + (transitionT * 0.8); 
                    y = (t * 4.8) - 1.2; 
                }
                arrowPts.push(new THREE.Vector3(r * Math.sin(angle), y, r * Math.cos(angle)));
            }

            const curve = new THREE.CatmullRomCurve3(arrowPts);
            const arrowMat = new THREE.MeshStandardMaterial({color: 0xffcc00, metalness: 1, roughness: 0.1, emissive: 0xffaa00, emissiveIntensity: 1.5});
            logoGroup.add(new THREE.Mesh(new THREE.TubeGeometry(curve, 80, 0.15, 12, false), arrowMat));
            
            const cone = new THREE.Mesh(new THREE.ConeGeometry(0.4, 0.9, 32), arrowMat);
            const tip = curve.getPoint(1);
            cone.position.copy(tip);
            cone.lookAt(tip.clone().add(curve.getTangent(1)));
            cone.rotateX(Math.PI/2); 
            logoGroup.add(cone);
            
            // Database
            const db = new THREE.Group();
            const silv = new THREE.MeshStandardMaterial({color: 0xffffff, metalness: 1, roughness: 0.02, emissive: 0x0066cc, emissiveIntensity: 0.3});
            for(let i=0; i<3; i++){
                const d = new THREE.Mesh(new THREE.CylinderGeometry(0.85, 0.85, 0.35, 32), silv);
                d.position.y = i * 0.5; db.add(d);
            }
            db.position.set(2.7 * Math.sin(1.1), -0.3, 2.7 * Math.cos(1.1));
            db.lookAt(0, -0.3, 0); db.rotateX(Math.PI); logoGroup.add(db);
        }

        function addTexts() {
            if(!font) return;
            const buildT = (txt, size, h, y, z, c, id) => {
                const geo = new THREE.TextGeometry(txt, { font: font, size: size, height: h, curveSegments: 12, bevelEnabled: true, bevelThickness: 0.03, bevelSize: 0.02 });
                geo.center();
                const mat = new THREE.MeshStandardMaterial({ color: 0xffffff, metalness: 1, roughness: 0.05, emissive: 0x444444, emissiveIntensity: 0.2 });
                mat.onBeforeCompile = (s) => {
                    s.uniforms.uR = { value: 4.2 }; s.uniforms.uC = { value: c };
                    s.vertexShader = `uniform float uR; uniform float uC;\n` + s.vertexShader.replace('#include <begin_vertex>', `
                        vec3 pos = position; float r = uR + pos.z; float a = (pos.x * uC);
                        vec3 transformed = vec3(r * sin(a), pos.y, r * cos(a));
                    `);
                };
                const m = new THREE.Mesh(geo, mat);
                m.position.set(0, y, z);
                logoGroup.add(m);
                selectableObjects[id] = m;
            };
            buildT('SEABI', 1.0, 0.4, config.objects.seabiText.y, config.objects.seabiText.z, 0.45, 'text_seabi');
            buildT('SEÇÃO DE ADMINISTRAÇÃO DE ESTRUTURAS DE BI', 0.16, 0.1, config.objects.descText.y, config.objects.descText.z, 0.38, 'text_desc');
        }

        function setupUI() {
            const gear = document.getElementById('gear-button');
            const editor = document.getElementById('editor-ui');
            const bottom = document.getElementById('bottom-ui');
            const selector = document.getElementById('object-selector');
            const slider = document.getElementById('orbit-speed-slider');

            gear.onclick = () => {
                uiVisible = !uiVisible;
                editor.classList.toggle('hidden', !uiVisible);
                bottom.classList.toggle('hidden', !uiVisible);
                mainLight.children[0].visible = uiVisible;
                p1.children[0].visible = uiVisible;
                p2.children[0].visible = uiVisible;
                extraLights.forEach(l => l.children[0].visible = uiVisible);
                if (!uiVisible) transform.detach();
            };

            slider.oninput = (e) => {
                orbit.autoRotateSpeed = e.target.value * -1.0;
            };

            selector.onchange = (e) => {
                const id = e.target.value;
                if (id === 'none') transform.detach();
                else transform.attach(selectableObjects[id]);
            };

            document.getElementById('btn-auto-orbit').onclick = (e) => {
                isAutoOrbit = !isAutoOrbit;
                orbit.autoRotate = isAutoOrbit;
                e.target.innerText = isAutoOrbit ? "Órbita Câmara: ON" : "Órbita Câmara: OFF";
            };

            document.getElementById('btn-export').onclick = () => {
                const data = {
                    camera: { pos: camera.position, target: orbit.target },
                    lights: { main: mainLight.position, p1: p1.position, p2: p2.position, extras: extraLights.map((l, i) => ({ id: `extra_${i+1}`, color: l.color.getHex(), pos: l.position })) },
                    logo: { rotY: logoGroup.rotation.y * (180 / Math.PI) },
                    objects: { globe: selectableObjects['globe'].position, seabiText: selectableObjects['text_seabi'].position, descText: selectableObjects['text_desc'].position },
                    timestamp: new Date().toISOString()
                };
                const ta = document.createElement('textarea');
                ta.value = JSON.stringify(data, null, 2);
                document.body.appendChild(ta); ta.select();
                document.execCommand('copy'); document.body.removeChild(ta);
                const toast = document.getElementById('toast');
                toast.style.top = '20px'; setTimeout(() => toast.style.top = '-100px', 2500);
            };

            window.addEventListener('keydown', (e) => {
                if (e.key.toLowerCase() === 'g') transform.setMode('translate');
                if (e.key.toLowerCase() === 'r') transform.setMode('rotate');
            });
        }

        function animate() {
            requestAnimationFrame(animate);
            orbit.update();
            renderer.render(scene, camera);
        }

        window.onload = init;
        window.onresize = () => {
            camera.aspect = window.innerWidth / window.innerHeight;
            camera.updateProjectionMatrix();
            renderer.setSize(window.innerWidth, window.innerHeight);
        };
    </script>
</body>
</html>

