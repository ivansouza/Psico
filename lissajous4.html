<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Lissajous Dystopia</title>
    <style>
        body { margin: 0; overflow: hidden; background-color: #050505; font-family: 'Courier New', Courier, monospace; }
        
        #ui {
            position: absolute;
            top: 20px;
            left: 20px;
            color: #00ff88;
            pointer-events: none;
            text-shadow: 0 0 5px #00ff88;
            z-index: 10;
        }

        /* Gear Icon */
        #settings-trigger {
            position: absolute;
            bottom: 25px;
            right: 25px;
            width: 45px;
            height: 45px;
            cursor: pointer;
            z-index: 100;
            transition: transform 0.3s ease;
            filter: drop-shadow(0 0 5px #00ff88);
        }
        #settings-trigger:hover { transform: rotate(90deg); }

        /* Control Panel */
        #control-panel {
            position: absolute;
            bottom: 80px;
            right: 25px;
            width: 250px;
            background: rgba(5, 10, 5, 0.85);
            border: 1px solid #00ff88;
            padding: 15px;
            color: #00ff88;
            border-radius: 8px;
            display: none;
            flex-direction: column;
            gap: 12px;
            z-index: 99;
            box-shadow: 0 0 15px rgba(0, 255, 136, 0.2);
            backdrop-filter: blur(5px);
        }
        #control-panel.active { display: flex; }
        
        .control-group { display: flex; flex-direction: column; gap: 5px; }
        label { font-size: 0.8rem; text-transform: uppercase; letter-spacing: 1px; }
        input[type="range"] { accent-color: #00ff88; cursor: pointer; }
        input[type="color"] { background: none; border: 1px solid #00ff88; cursor: pointer; width: 100%; height: 30px; }
        
        canvas { display: block; }
    </style>
</head>
<body>
    <div id="ui">
        <h1>NEON ENTROPY v1.1</h1>
        <p>Lissajous Resonance: ACTIVE</p>
    </div>

    <!-- Gear Icon SVG -->
    <div id="settings-trigger" onclick="togglePanel()">
        <svg viewBox="0 0 24 24" fill="none" stroke="#00ff88" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
            <circle cx="12" cy="12" r="3"></circle>
            <path d="M19.4 15a1.65 1.65 0 0 0 .33 1.82l.06.06a2 2 0 0 1 0 2.83 2 2 0 0 1-2.83 0l-.06-.06a1.65 1.65 0 0 0-1.82-.33 1.65 1.65 0 0 0-1 1.51V21a2 2 0 0 1-2 2 2 2 0 0 1-2-2v-.09A1.65 1.65 0 0 0 9 19.4a1.65 1.65 0 0 0-1.82.33l-.06.06a2 2 0 0 1-2.83 0 2 2 0 0 1 0-2.83l.06-.06a1.65 1.65 0 0 0 .33-1.82 1.65 1.65 0 0 0-1.51-1H3a2 2 0 0 1-2-2 2 2 0 0 1 2-2h.09A1.65 1.65 0 0 0 4.6 9a1.65 1.65 0 0 0-.33-1.82l-.06-.06a2 2 0 0 1 0-2.83 2 2 0 0 1 2.83 0l.06.06a1.65 1.65 0 0 0 1.82.33H9a1.65 1.65 0 0 0 1-1.51V3a2 2 0 0 1 2-2 2 2 0 0 1 2 2v.09a1.65 1.65 0 0 0 1 1.51 1.65 1.65 0 0 0 1.82-.33l.06-.06a2 2 0 0 1 2.83 0 2 2 0 0 1 0 2.83l-.06.06a1.65 1.65 0 0 0-.33 1.82V9a1.65 1.65 0 0 0 1.51 1H21a2 2 0 0 1 2 2 2 2 0 0 1-2 2h-.09a1.65 1.65 0 0 0-1.51 1z"></path>
        </svg>
    </div>

    <!-- Control Panel -->
    <div id="control-panel">
        <div class="control-group">
            <label>Frequência A (X)</label>
            <input type="range" id="paramA" min="1" max="10" step="0.1" value="3.0">
        </div>
        <div class="control-group">
            <label>Frequência B (Y)</label>
            <input type="range" id="paramB" min="1" max="10" step="0.1" value="2.0">
        </div>
        <div class="control-group">
            <label>Velocidade</label>
            <input type="range" id="paramSpeed" min="0" max="3" step="0.1" value="0.5">
        </div>
        <div class="control-group">
            <label>Cor Neon</label>
            <input type="color" id="paramColor" value="#00ff88">
        </div>
        <div class="control-group">
            <label>Auto-Oscilação</label>
            <input type="range" id="paramOsc" min="0" max="1" step="0.1" value="0.5">
        </div>
    </div>

    <!-- Three.js CDN -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/three@0.128.0/examples/js/controls/OrbitControls.js"></script>

    <!-- Shader do Terreno -->
    <script id="groundVertexShader" type="x-shader/x-vertex">
        varying vec2 vUv;
        varying float vElevation;
        uniform float uTime;

        void main() {
            vUv = uv;
            vec4 modelPosition = modelMatrix * vec4(position, 1.0);
            float elevation = sin(modelPosition.x * 0.2) * cos(modelPosition.z * 0.2) * 0.5;
            modelPosition.y += elevation;
            vElevation = elevation;
            gl_Position = projectionMatrix * viewMatrix * modelPosition;
        }
    </script>

    <script id="groundFragmentShader" type="x-shader/x-fragment">
        varying vec2 vUv;
        varying float vElevation;
        uniform float uTime;
        uniform vec3 uNeonColor;

        float hash(vec2 p) { return fract(sin(dot(p, vec2(127.1, 311.7))) * 43758.5453123); }
        
        float voronoi(vec2 x) {
            vec2 n = floor(x);
            vec2 f = fract(x);
            float m = 1.0;
            for(int j=-1; j<=1; j++)
            for(int i=-1; i<=1; i++) {
                vec2 g = vec2(float(i),float(j));
                vec2 o = vec2(hash(n + g));
                vec2 r = g + o - f;
                float d = dot(r,r);
                if(d < m) m = d;
            }
            return sqrt(m);
        }

        void main() {
            vec2 uv = vUv * 20.0;
            float v = voronoi(uv);
            vec3 baseColor = vec3(0.08, 0.05, 0.02);
            float crack = smoothstep(0.3, 0.0, v);
            vec3 crackColor = vec3(0.15, 0.1, 0.05) * crack;
            
            float neonGlow = 1.0 / (vElevation + 2.5);
            vec3 glow = uNeonColor * 0.2 * neonGlow * (sin(uTime * 0.5) * 0.5 + 0.5);

            gl_FragColor = vec4(baseColor + crackColor + glow, 1.0);
        }
    </script>

    <!-- Shader da Curva -->
    <script id="lissajousVertexShader" type="x-shader/x-vertex">
        uniform float uTime;
        uniform float uA;
        uniform float uB;
        uniform float uDelta;
        varying float vProgress;

        void main() {
            float t = position.x + uTime; 
            vProgress = position.x / 6.28318;

            float x = sin(uA * t + uDelta) * 5.0;
            float y = sin(uB * t) * 5.0 + 6.0; 
            float z = cos(uA * t * 0.5) * 3.0;

            vec3 newPosition = vec3(x, y, z);
            newPosition.y += sin(uTime + x) * 0.2;

            gl_Position = projectionMatrix * modelViewMatrix * vec4(newPosition, 1.0);
            gl_PointSize = 4.0;
        }
    </script>

    <script id="lissajousFragmentShader" type="x-shader/x-fragment">
        varying float vProgress;
        uniform float uTime;
        uniform vec3 uColor;

        void main() {
            float pulse = sin(uTime * 3.0) * 0.2 + 0.8;
            vec3 color = uColor * pulse;
            gl_FragColor = vec4(color, 1.0);
        }
    </script>

    <script>
        let scene, camera, renderer, controls, clock;
        let groundMaterial, lissajousMaterial;
        
        // Configurações controláveis
        const params = {
            a: 3.0,
            b: 2.0,
            speed: 0.5,
            color: '#00ff88',
            oscillation: 0.5
        };

        function togglePanel() {
            const panel = document.getElementById('control-panel');
            panel.classList.toggle('active');
        }

        function init() {
            scene = new THREE.Scene();
            scene.background = new THREE.Color(0x020205);
            scene.fog = new THREE.FogExp2(0x020205, 0.05);

            camera = new THREE.PerspectiveCamera(75, window.innerWidth / window.innerHeight, 0.1, 1000);
            camera.position.set(12, 8, 12);

            renderer = new THREE.WebGLRenderer({ antialias: true });
            renderer.setSize(window.innerWidth, window.innerHeight);
            renderer.setPixelRatio(Math.min(window.devicePixelRatio, 2));
            document.body.appendChild(renderer.domElement);

            controls = new THREE.OrbitControls(camera, renderer.domElement);
            controls.enableDamping = true;
            controls.autoRotate = true;
            controls.autoRotateSpeed = 0.5;

            clock = new THREE.Clock();

            // Listeners da UI
            document.getElementById('paramA').addEventListener('input', (e) => params.a = parseFloat(e.target.value));
            document.getElementById('paramB').addEventListener('input', (e) => params.b = parseFloat(e.target.value));
            document.getElementById('paramSpeed').addEventListener('input', (e) => params.speed = parseFloat(e.target.value));
            document.getElementById('paramOsc').addEventListener('input', (e) => params.oscillation = parseFloat(e.target.value));
            document.getElementById('paramColor').addEventListener('input', (e) => {
                params.color = e.target.value;
                const threeCol = new THREE.Color(params.color);
                lissajousMaterial.uniforms.uColor.value = threeCol;
                groundMaterial.uniforms.uNeonColor.value = threeCol;
            });

            createWasteland();
            createLissajous();
            createAtmosphere();

            window.addEventListener('resize', onWindowResize, false);
            animate();
        }

        function createWasteland() {
            const geometry = new THREE.PlaneGeometry(100, 100, 100, 100);
            geometry.rotateX(-Math.PI / 2);

            groundMaterial = new THREE.ShaderMaterial({
                vertexShader: document.getElementById('groundVertexShader').textContent,
                fragmentShader: document.getElementById('groundFragmentShader').textContent,
                uniforms: {
                    uTime: { value: 0 },
                    uNeonColor: { value: new THREE.Color(params.color) }
                }
            });

            const ground = new THREE.Mesh(geometry, groundMaterial);
            scene.add(ground);
        }

        function createLissajous() {
            const count = 3000;
            const positions = new Float32Array(count * 3);
            for(let i = 0; i < count; i++) {
                positions[i * 3] = (i / count) * Math.PI * 2; 
                positions[i * 3 + 1] = 0;
                positions[i * 3 + 2] = 0;
            }

            const geometry = new THREE.BufferGeometry();
            geometry.setAttribute('position', new THREE.BufferAttribute(positions, 3));

            lissajousMaterial = new THREE.ShaderMaterial({
                vertexShader: document.getElementById('lissajousVertexShader').textContent,
                fragmentShader: document.getElementById('lissajousFragmentShader').textContent,
                transparent: true,
                uniforms: {
                    uTime: { value: 0 },
                    uA: { value: params.a },
                    uB: { value: params.b },
                    uDelta: { value: Math.PI / 2 },
                    uColor: { value: new THREE.Color(params.color) }
                },
                blending: THREE.AdditiveBlending
            });

            const curve = new THREE.Points(geometry, lissajousMaterial);
            scene.add(curve);
        }

        function createAtmosphere() {
            const sunGeom = new THREE.SphereGeometry(10, 32, 32);
            const sunMat = new THREE.MeshBasicMaterial({
                color: 0xff3300,
                transparent: true,
                opacity: 0.1,
                side: THREE.BackSide
            });
            const sun = new THREE.Mesh(sunGeom, sunMat);
            sun.position.set(0, -5, -50);
            scene.add(sun);

            const hemiLight = new THREE.HemisphereLight(0x442211, 0x050505, 0.5);
            scene.add(hemiLight);
        }

        function onWindowResize() {
            camera.aspect = window.innerWidth / window.innerHeight;
            camera.updateProjectionMatrix();
            renderer.setSize(window.innerWidth, window.innerHeight);
        }

        function animate() {
            requestAnimationFrame(animate);
            const elapsedTime = clock.getElapsedTime();
            const delta = params.speed * 0.02;

            groundMaterial.uniforms.uTime.value = elapsedTime;
            
            lissajousMaterial.uniforms.uTime.value = elapsedTime * params.speed;
            
            // Combina o valor do slider com uma pequena oscilação automática (opcional)
            lissajousMaterial.uniforms.uA.value = params.a + Math.sin(elapsedTime * 0.2) * params.oscillation;
            lissajousMaterial.uniforms.uB.value = params.b + Math.cos(elapsedTime * 0.3) * params.oscillation;
            lissajousMaterial.uniforms.uDelta.value += 0.01;

            if (Math.random() > 0.98) {
                scene.background = new THREE.Color(0x050308);
            } else {
                scene.background = new THREE.Color(0x020205);
            }

            controls.update();
            renderer.render(scene, camera);
        }

        window.onload = init;
    </script>
</body>
</html>

