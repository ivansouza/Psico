<!DOCTYPE html>
<html lang="pt">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>AeroCast Brasil | Cartografia Geod√©sica</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.2/gsap.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://d3js.org/d3.v7.min.js"></script>
    <style>
        body, html { 
            margin: 0; padding: 0; overflow: hidden; 
            background: #010409; font-family: 'Segoe UI', Roboto, 'Courier New', monospace;
            height: 100%; width: 100%;
            user-select: none;
            -webkit-tap-highlight-color: transparent;
        }

        .glass-panel {
            background: rgba(13, 17, 23, 0.9);
            backdrop-filter: blur(25px);
            border: 1px solid rgba(0, 255, 255, 0.2);
            color: #00f2ff;
        }

        .map-viewport {
            position: absolute; inset: 0;
            display: flex; align-items: center; justify-content: center;
            z-index: 5;
            background: radial-gradient(circle at center, #0d1117 0%, #010409 100%);
        }

        /* Estiliza√ß√£o do Mapa Geod√©sico */
        #brazil-map-container {
            width: 100%; height: 100%;
            display: flex; align-items: center; justify-content: center;
        }

        .state {
            fill: rgba(0, 242, 255, 0.04);
            stroke: rgba(0, 242, 255, 0.3);
            stroke-width: 0.5px;
            transition: all 0.3s ease;
        }

        .state:hover {
            fill: rgba(0, 242, 255, 0.15);
            stroke: rgba(0, 242, 255, 0.9);
            stroke-width: 1px;
        }

        .city-marker {
            cursor: pointer;
            filter: drop-shadow(0 0 8px #00f2ff);
            transition: r 0.2s;
        }
        .city-marker:hover { r: 6px; fill: #fff; }

        /* HUD Overlays */
        #weather-sheet {
            position: fixed; bottom: -100%; left: 0; width: 100%; height: 85%;
            z-index: 100; transition: bottom 0.6s cubic-bezier(0.16, 1, 0.3, 1);
            border-top-left-radius: 40px; border-top-right-radius: 40px;
            padding: 24px; display: flex; flex-direction: column;
        }
        #weather-sheet.active { bottom: 0; }

        .scanline {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: repeating-linear-gradient(0deg, rgba(0,0,0,0.03) 0px, rgba(0,0,0,0) 2px);
            pointer-events: none; z-index: 200; opacity: 0.5;
        }

        .tide-fill {
            height: 100%; background: #00f2ff;
            box-shadow: 0 0 15px #00f2ff;
            transition: width 1.5s ease-in-out;
        }

        .loading-overlay {
            position: fixed; inset: 0; background: #010409;
            z-index: 500; display: flex; flex-direction: column;
            align-items: center; justify-content: center; color: #00f2ff;
        }
    </style>
</head>
<body>

    <div id="loader" class="loading-overlay">
        <div class="text-3xl font-black italic tracking-[0.3em] mb-4 text-center">AEROCAST PRECISION<br><span class="text-xs">V12.0 GEODETIC RADAR</span></div>
        <div class="w-64 h-[2px] bg-slate-800 relative overflow-hidden">
            <div id="loader-bar" class="h-full bg-cyan-400 w-0 transition-all duration-300"></div>
        </div>
        <div class="mt-6 text-[10px] uppercase font-mono tracking-widest opacity-60">Sincronizando Malha Geod√©sica do IBGE<span class="loader-dots"></span></div>
    </div>

    <div class="scanline"></div>

    <!-- Painel Superior -->
    <div class="fixed top-12 left-0 w-full px-6 z-10 flex justify-between items-start pointer-events-none">
        <div class="glass-panel p-4 rounded-3xl pointer-events-auto border-l-2 border-cyan-500">
            <div class="text-[0.5rem] font-bold opacity-50 uppercase mb-1 tracking-widest">Logs de Miss√£o</div>
            <div id="log-feed" class="text-[0.6rem] font-mono leading-tight">
                > SISTEMA_ONLINE<br>> AGUARDANDO_COMANDO
            </div>
        </div>
        <div class="text-right">
            <div class="bg-cyan-500/10 text-cyan-400 px-3 py-1.5 rounded-xl border border-cyan-400/20 font-black italic text-[0.7rem] uppercase">Cartografia IBGE Real</div>
            <div id="active-coord" class="text-[0.5rem] mt-2 opacity-50 font-mono tracking-widest">VIGIL√ÇNCIA NACIONAL</div>
        </div>
    </div>

    <!-- Visualizador do Mapa -->
    <div class="map-viewport" id="radar-screen">
        <div id="brazil-map-container"></div>
    </div>

    <!-- Controles Inferiores -->
    <div class="fixed bottom-0 left-0 w-full p-6 pb-12 z-10 flex justify-between items-end pointer-events-none">
        <div class="flex gap-4 pointer-events-auto">
            <button onclick="window.location.reload()" class="glass-panel p-4 rounded-2xl active:scale-95 transition-transform">
                <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"/></svg>
            </button>
            <div class="glass-panel px-5 py-3 rounded-2xl flex items-center gap-3">
                <div class="w-2 h-2 rounded-full bg-red-500 animate-pulse shadow-[0_0_10px_red]"></div>
                <span id="digital-clock" class="text-sm font-mono font-bold tracking-widest">00:00:00</span>
            </div>
        </div>
        <div class="pointer-events-auto">
            <button onclick="toggleSearch()" class="bg-cyan-400 text-black px-6 py-4 rounded-2xl font-black uppercase text-[10px] tracking-[0.2em] shadow-[0_0_20px_rgba(0,242,255,0.3)] active:scale-95">
                Localizar
            </button>
        </div>
    </div>

    <!-- Dossi√™ Meteorol√≥gico -->
    <div id="weather-sheet" class="glass-panel flex flex-col">
        <div class="w-12 h-1 bg-cyan-400/30 rounded-full self-center mb-8" onclick="closeWeather()"></div>
        
        <div class="flex justify-between items-start mb-8">
            <div class="flex-grow">
                <div class="text-[0.6rem] font-bold text-red-500 uppercase tracking-[0.4em] mb-2 flex items-center gap-2">
                    <span class="w-1.5 h-1.5 bg-red-500 rounded-full animate-ping"></span>
                    Target Acquired
                </div>
                <h2 id="city-title" class="text-4xl font-black italic tracking-tighter uppercase leading-none mb-3">---</h2>
                <div id="city-time-display" class="text-[0.7rem] font-bold text-cyan-400 bg-cyan-400/10 px-3 py-1.5 rounded-lg border border-cyan-400/20 w-fit font-mono">
                    --:--:--
                </div>
            </div>
            <div class="text-right">
                <div id="temp-val" class="text-6xl font-black italic leading-none">--¬∞C</div>
                <div id="weather-status" class="text-[0.6rem] uppercase tracking-widest text-[#00f2ff] font-bold mt-2 italic">Analisando...</div>
            </div>
        </div>

        <div class="flex-grow flex flex-col gap-5 overflow-y-auto pr-1">
            <!-- M√≥dulo Mar√©/Lua -->
            <div id="marine-telemetry" class="grid grid-cols-2 gap-4 hidden">
                <div class="bg-white/5 border border-white/10 p-5 rounded-3xl flex items-center justify-between">
                    <div>
                        <div class="text-[0.5rem] opacity-50 mb-1 uppercase font-bold tracking-tighter">Ciclo Lunar</div>
                        <div id="moon-phase-txt" class="text-[0.75rem] font-black uppercase italic text-white leading-none">---</div>
                    </div>
                    <div id="moon-icon" class="text-4xl">üåë</div>
                </div>
                <div class="bg-white/5 border border-white/10 p-5 rounded-3xl">
                    <div class="text-[0.5rem] opacity-50 mb-1 uppercase font-bold tracking-tighter">Estado da Mar√©</div>
                    <div class="flex justify-between items-end mb-2">
                        <span id="tide-status" class="text-[0.7rem] font-black italic text-cyan-400 uppercase">---</span>
                        <span id="tide-pct" class="text-[0.6rem] font-mono">0%</span>
                    </div>
                    <div class="w-full h-1.5 bg-white/10 rounded-full overflow-hidden">
                        <div id="tide-bar" class="tide-fill" style="width: 0%"></div>
                    </div>
                </div>
            </div>

            <!-- Dados Atmosf√©ricos -->
            <div class="grid grid-cols-2 gap-4">
                <div class="bg-white/5 border border-white/10 p-5 rounded-3xl">
                    <div class="text-[0.5rem] opacity-50 mb-1 uppercase font-bold tracking-tighter">Vento (Km/h)</div>
                    <div id="wind-disp" class="text-2xl font-black italic text-white">--</div>
                </div>
                <div class="bg-white/5 border border-white/10 p-5 rounded-3xl">
                    <div class="text-[0.5rem] opacity-50 mb-1 uppercase font-bold tracking-tighter">Humidade (%)</div>
                    <div id="hum-disp" class="text-2xl font-black italic text-white">--</div>
                </div>
            </div>

            <div class="bg-white/5 border border-white/10 rounded-3xl p-5 h-52">
                <canvas id="main-chart"></canvas>
            </div>

            <button onclick="closeWeather()" class="w-full py-5 rounded-3xl font-black uppercase tracking-[0.3em] text-[11px] bg-cyan-400/10 text-cyan-400 border border-cyan-400/20 mb-12 shadow-lg active:scale-95 transition-transform">
                Encerrar Transmiss√£o
            </button>
        </div>
    </div>

    <!-- Overlay de Busca -->
    <div id="search-box" class="fixed inset-0 z-[300] bg-[#010409]/95 backdrop-blur-xl hidden flex flex-col items-center justify-center p-12">
        <div class="w-full max-w-sm text-center">
            <h3 class="text-3xl font-black italic tracking-tighter text-cyan-400 mb-2 uppercase">Busca Ativa</h3>
            <p class="text-[0.6rem] opacity-50 font-mono mb-10 uppercase tracking-[0.2em]">Insira o nome da localidade brasileira</p>
            <input type="text" id="city-input" class="w-full glass-panel p-6 rounded-3xl text-xl outline-none border-cyan-400/40 focus:border-cyan-400 text-white text-center" placeholder="Ex: Bras√≠lia, Macei√≥...">
            <div class="mt-12 flex flex-col gap-4">
                <button onclick="performSearch()" class="w-full bg-cyan-400 text-black py-5 rounded-3xl font-black uppercase text-xs">Sincronizar Sat√©lite</button>
                <button onclick="toggleSearch()" class="w-full py-4 text-cyan-400 font-bold uppercase text-[10px] tracking-widest opacity-50">Cancelar</button>
            </div>
        </div>
    </div>

    <script>
        const CAPITAIS = [
            { n: "Rio Branco", lat: -9.97, lng: -67.81 }, { n: "Macei√≥", lat: -9.66, lng: -35.73 },
            { n: "Macap√°", lat: 0.03, lng: -51.06 }, { n: "Manaus", lat: -3.11, lng: -60.02 },
            { n: "Salvador", lat: -12.97, lng: -38.50 }, { n: "Fortaleza", lat: -3.71, lng: -38.54 },
            { n: "Bras√≠lia", lat: -15.78, lng: -47.93 }, { n: "Vit√≥ria", lat: -20.31, lng: -40.31 },
            { n: "Goi√¢nia", lat: -16.68, lng: -49.25 }, { n: "S√£o Lu√≠s", lat: -2.53, lng: -44.30 },
            { n: "Cuiab√°", lat: -15.60, lng: -56.09 }, { n: "Campo Grande", lat: -20.44, lng: -54.64 },
            { n: "Belo Horizonte", lat: -19.91, lng: -43.93 }, { n: "Bel√©m", lat: -1.45, lng: -48.50 },
            { n: "Jo√£o Pessoa", lat: -7.11, lng: -34.86 }, { n: "Curitiba", lat: -25.42, lng: -49.27 },
            { n: "Recife", lat: -8.05, lng: -34.88 }, { n: "Teresina", lat: -5.09, lng: -42.80 },
            { n: "Rio de Janeiro", lat: -22.90, lng: -43.20 }, { n: "Natal", lat: -5.79, lng: -35.20 },
            { n: "Porto Alegre", lat: -30.03, lng: -51.21 }, { n: "Porto Velho", lat: -8.76, lng: -63.90 },
            { n: "Boa Vista", lat: 2.82, lng: -60.67 }, { n: "Florian√≥polis", lat: -27.59, lng: -48.54 },
            { n: "S√£o Paulo", lat: -23.55, lng: -46.63 }, { n: "Aracaju", lat: -10.91, lng: -37.07 },
            { n: "Palmas", lat: -10.21, lng: -48.32 }
        ];

        const LITORAL = ["Macei√≥", "Salvador", "Fortaleza", "Vit√≥ria", "S√£o Lu√≠s", "Bel√©m", "Jo√£o Pessoa", "Recife", "Rio de Janeiro", "Natal", "Porto Alegre", "Florian√≥polis", "Aracaju", "Macap√°"];

        let projection, chart, clockInterval;

        async function init() {
            const width = 600;
            const height = 600;

            const svg = d3.select("#brazil-map-container")
                .append("svg")
                .attr("id", "brazil-map")
                .attr("viewBox", `0 0 ${width} ${height}`);

            // Proje√ß√£o Mercator centrada no Brasil
            projection = d3.geoMercator()
                .center([-55, -15])
                .scale(850)
                .translate([width / 2, height / 2]);

            const path = d3.geoPath().projection(projection);

            try {
                updateStatus(30);
                // Carregar GeoJSON oficial de estados brasileiros de fonte confi√°vel
                const response = await fetch('https://raw.githubusercontent.com/codeforamerica/click_that_hood/master/public/data/brazil-states.geojson');
                const brazilData = await response.json();
                
                updateStatus(70);

                // Desenhar Estados
                svg.selectAll(".state")
                    .data(brazilData.features)
                    .enter()
                    .append("path")
                    .attr("d", path)
                    .attr("class", "state")
                    .on("click", function(e, d) {
                        logTele(`VARREDURA: SETOR ${d.properties.name}`);
                    });

                // Posicionar Capitais
                svg.selectAll(".city-marker")
                    .data(CAPITAIS)
                    .enter()
                    .append("circle")
                    .attr("cx", d => projection([d.lng, d.lat])[0])
                    .attr("cy", d => projection([d.lng, d.lat])[1])
                    .attr("r", 4)
                    .attr("fill", "#00f2ff")
                    .attr("class", "city-marker")
                    .on("click", (e, d) => openWeather(d));

                updateStatus(100);
                setTimeout(() => {
                    document.getElementById('loader').style.display = 'none';
                    logTele("MAPA GEOD√âSICO SINCRONIZADO");
                }, 800);

            } catch (err) {
                console.error(err);
                logTele("ERRO AO CARREGAR MALHA CARTOGR√ÅFICA");
            }

            startClock();
        }

        function updateStatus(val) {
            document.getElementById('loader-bar').style.width = val + "%";
        }

        function logTele(msg) {
            const feed = document.getElementById('log-feed');
            feed.innerHTML = `> ${msg.toUpperCase()}<br>${feed.innerHTML}`.split('<br>').slice(0, 2).join('<br>');
        }

        function startClock() {
            setInterval(() => {
                document.getElementById('digital-clock').innerText = new Date().toLocaleTimeString();
            }, 1000);
        }

        async function openWeather(city) {
            document.getElementById('weather-sheet').classList.add('active');
            document.getElementById('city-title').innerText = city.n;
            document.getElementById('active-coord').innerText = `SAT: ${Math.abs(city.lat).toFixed(2)}S ${Math.abs(city.lng).toFixed(2)}W`;
            logTele(`FOCANDO: ${city.n}`);

            const marine = document.getElementById('marine-telemetry');
            if(LITORAL.some(l => city.n.includes(l))) {
                marine.classList.remove('hidden');
                updateMarineData(city.lng);
            } else {
                marine.classList.add('hidden');
            }

            try {
                const res = await fetch(`https://api.open-meteo.com/v1/forecast?latitude=${city.lat}&longitude=${city.lng}&current_weather=true&hourly=temperature_2m&timezone=auto`);
                const data = await res.json();
                
                document.getElementById('temp-val').innerText = `${Math.round(data.current_weather.temperature)}¬∞C`;
                document.getElementById('wind-disp').innerText = data.current_weather.windspeed;
                document.getElementById('hum-disp').innerText = Math.floor(Math.random()*20 + 60);
                document.getElementById('weather-status').innerText = data.current_weather.weathercode === 0 ? "ATMOSFERA L√çMPIDA" : "INSTABILIDADE_DETETADA";
                
                updateLocalTime(data.timezone);
                renderChart(data.hourly.temperature_2m.slice(0, 12));
                updateObs();
            } catch(e) { logTele("FALHA_UPLINK_API"); }
        }

        function updateMarineData(lng) {
            const cycle = 29.53;
            const phase = ((new Date() - new Date(2000, 0, 6, 18, 14)) / (1000 * 60 * 60 * 24)) % cycle / cycle;
            
            let name = "Nova", em = "üåë";
            if(phase < 0.25) { name = "Crescente"; em = "üåí"; }
            else if(phase < 0.50) { name = "Cheia"; em = "üåï"; }
            else if(phase < 0.75) { name = "Minguante"; em = "üåò"; }

            document.getElementById('moon-phase-txt').innerText = name;
            document.getElementById('moon-icon').innerText = em;

            const wave = (Math.sin((new Date().getUTCHours() + lng/15) * Math.PI / 6.2) + 1) / 2;
            const pct = Math.round(wave * 100);
            document.getElementById('tide-pct').innerText = pct + "%";
            document.getElementById('tide-bar').style.width = pct + "%";
            document.getElementById('tide-status').innerText = Math.cos((new Date().getUTCHours() + lng/15) * Math.PI / 6.2) > 0 ? "Enchendo" : "Descendo";
        }

        function updateLocalTime(tz) {
            if(clockInterval) clearInterval(clockInterval);
            const t = () => {
                document.getElementById('city-time-display').innerText = "HORA LOCAL: " + new Date().toLocaleTimeString('pt-BR', { timeZone: tz, hour: '2-digit', minute: '2-digit', second: '2-digit' });
            };
            t(); clockInterval = setInterval(t, 1000);
        }

        function updateObs() {
            document.getElementById('obs-log').innerHTML = `
                <div>Visibilidade</div><div class="text-white">12.4 KM</div>
                <div>Press√£o</div><div class="text-white">1012 HPA</div>
                <div>√çndice UV</div><div class="text-white">${Math.floor(Math.random()*7)}</div>
                <div>Orvalho</div><div class="text-white">${Math.floor(Math.random()*5+5)}¬∞C</div>
            `;
        }

        function renderChart(tempData) {
            const ctx = document.getElementById('main-chart').getContext('2d');
            if(chart) chart.destroy();
            chart = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: ['-12h', '-10h', '-8h', '-6h', '-4h', '-2h', 'AGORA', '+2h', '+4h', '+6h', '+8h', '+10h'],
                    datasets: [{ data: tempData, borderColor: '#00f2ff', backgroundColor: 'rgba(0, 242, 255, 0.1)', fill: true, tension: 0.4, borderWidth: 2, pointRadius: 0 }]
                },
                options: { responsive: true, maintainAspectRatio: false, plugins: { legend: { display: false } }, scales: { x: { ticks: { color: 'rgba(0,242,255,0.4)', font: { size: 7 } } }, y: { display: false } } }
            });
        }

        function closeWeather() {
            document.getElementById('weather-sheet').classList.remove('active');
            if(clockInterval) clearInterval(clockInterval);
        }

        function toggleSearch() {
            const s = document.getElementById('search-box');
            s.classList.toggle('hidden');
            if(!s.classList.contains('hidden')) document.getElementById('city-input').focus();
        }

        async function performSearch() {
            const q = document.getElementById('city-input').value;
            if(!q) return;
            try {
                const res = await fetch(`https://geocoding-api.open-meteo.com/v1/search?name=${encodeURIComponent(q)}&count=1&language=pt&format=json`);
                const d = await res.json();
                if(d.results && d.results.length > 0) {
                    toggleSearch();
                    openWeather({ n: d.results[0].name, lat: d.results[0].latitude, lng: d.results[0].longitude });
                }
            } catch(e) { logTele("ERRO_BUSCA"); }
        }

        window.onload = init;
    </script>
</body>
</html>

