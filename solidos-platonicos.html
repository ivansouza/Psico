<!DOCTYPE html>
<html lang="pt-pt">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Geometria Sagrada: Sólidos Platónicos</title>
    <!-- Carregamento Global (Standard) -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
    <!-- OrbitControls para versão R128 -->
    <script src="https://cdn.jsdelivr.net/gh/mrdoob/three.js@r128/examples/js/controls/OrbitControls.js"></script>
    <style>
        :root {
            --panel-bg: rgba(20, 20, 25, 0.95);
            --accent: #00d4ff;
            --text: #ffffff;
            --border: rgba(255, 255, 255, 0.2);
        }

        body, html { 
            margin: 0; 
            padding: 0;
            width: 100%;
            height: 100%;
            overflow: hidden; 
            background-color: #0a0a0f; 
            font-family: 'Segoe UI', system-ui, sans-serif;
        }

        canvas { 
            display: block; 
            position: fixed;
            top: 0;
            left: 0;
            z-index: 1;
        }

        /* Botão de Engrenagem */
        #gear-btn {
            position: absolute;
            top: 20px;
            right: 20px;
            background: var(--panel-bg);
            border: 1px solid var(--border);
            padding: 12px;
            border-radius: 50%;
            cursor: pointer;
            z-index: 100;
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: 0 4px 15px rgba(0,0,0,0.5);
            transition: transform 0.3s ease;
        }

        #gear-btn:hover { transform: rotate(45deg); background: var(--accent); }
        #gear-btn svg { width: 24px; height: 24px; fill: white; }

        /* Janela de Configurações */
        #settings-panel {
            position: absolute;
            top: 80px;
            right: 20px;
            width: 300px;
            max-height: 85vh;
            background: var(--panel-bg);
            backdrop-filter: blur(15px);
            border-radius: 12px;
            border: 1px solid var(--border);
            z-index: 90;
            display: flex;
            flex-direction: column;
            color: var(--text);
            box-shadow: 0 10px 40px rgba(0,0,0,0.8);
            transition: opacity 0.3s, transform 0.3s;
        }

        .hidden { opacity: 0; pointer-events: none; transform: translateY(-10px); }

        .panel-header { padding: 15px; border-bottom: 1px solid var(--border); font-weight: bold; color: var(--accent); font-size: 0.8rem; letter-spacing: 1px; }
        .panel-content { padding: 15px; overflow-y: auto; flex-grow: 1; }
        
        /* Scrollbar */
        .panel-content::-webkit-scrollbar { width: 4px; }
        .panel-content::-webkit-scrollbar-thumb { background: var(--accent); border-radius: 10px; }

        h2 { font-size: 0.7rem; margin: 15px 0 10px 0; color: #aaa; text-transform: uppercase; letter-spacing: 1px; border-bottom: 1px solid rgba(255,255,255,0.05); padding-bottom: 5px; }

        .btn-grid { display: grid; grid-template-columns: 1fr; gap: 6px; }

        button.control-btn {
            background: rgba(255,255,255,0.05);
            border: 1px solid var(--border);
            color: white;
            padding: 8px;
            border-radius: 6px;
            cursor: pointer;
            font-size: 0.7rem;
            text-align: left;
            transition: 0.2s;
        }

        button.control-btn.active { background: var(--accent); color: black; font-weight: bold; }

        /* Sliders e Checkboxes */
        .control-group { margin-bottom: 15px; padding-bottom: 5px; border-bottom: 1px solid rgba(255,255,255,0.03); }
        .label-row { display: flex; justify-content: space-between; align-items: center; font-size: 0.75rem; margin-bottom: 6px; }
        .label-row span:first-child { font-weight: 500; }
        .val-display { color: var(--accent); font-family: monospace; }
        
        .toggles-row { display: flex; gap: 10px; margin-bottom: 8px; }
        .check-toggle { display: flex; align-items: center; gap: 5px; font-size: 0.65rem; color: #888; cursor: pointer; }
        .check-toggle input { cursor: pointer; accent-color: var(--accent); width: 14px; height: 14px; margin: 0; }

        input[type=range] { width: 100%; cursor: pointer; accent-color: var(--accent); height: 4px; }

        .global-toggle {
            background: rgba(255,212,0,0.1);
            padding: 10px;
            border-radius: 6px;
            margin-bottom: 10px;
            border: 1px dashed rgba(255,212,0,0.3);
        }
    </style>
</head>
<body>

    <button id="gear-btn">
        <svg viewBox="0 0 24 24"><path d="M19.14,12.94c0.04-0.3,0.06-0.61,0.06-0.94c0-0.32-0.02-0.64-0.07-0.94l2.03-1.58c0.18-0.14,0.23-0.41,0.12-0.61 l-1.92-3.32c-0.12-0.22-0.37-0.29-0.59-0.22l-2.39,0.96c-0.5-0.38-1.03-0.7-1.62-0.94L14.4,2.81c-0.04-0.24-0.24-0.41-0.48-0.41 h-3.84c-0.24,0-0.43,0.17-0.47,0.41L9.25,5.35C8.66,5.59,8.12,5.92,7.63,6.29L5.24,5.33c-0.22-0.08-0.47,0-0.59,0.22L2.74,8.87 C2.62,9.08,2.66,9.34,2.86,9.48l2.03,1.58C4.84,11.36,4.82,11.67,4.82,12c0,0.33,0.02,0.64,0.07,0.94l-2.03,1.58 c-0.18,0.14-0.23,0.41-0.12,0.61l1.92,3.32c0.12,0.22,0.37,0.29,0.59,0.22l2.39-0.96c0.5,0.38,1.03,0.7,1.62,0.94l0.36,2.54 c0.05,0.24,0.24,0.41,0.48,0.41h3.84c0.24,0,0.44-0.17,0.47-0.41l0.36-2.54c0.59-0.24,1.13-0.56,1.62-0.94l2.39,0.96 c0.22,0.08,0.47,0,0.59-0.22l1.92-3.32c0.12-0.22,0.07-0.47-0.12-0.61L19.14,12.94z M12,15.5c-1.93,0-3.5-1.57-3.5-3.5 s1.57-3.5,3.5-3.5s3.5,1.57,3.5,3.5S13.93,15.5,12,15.5z"/></svg>
    </button>

    <div id="settings-panel" class="hidden">
        <div class="panel-header">CONFIGURAÇÕES</div>
        <div class="panel-content">
            <div class="section">
                <h2>Câmara e Rotação</h2>
                
                <div class="global-toggle">
                    <label class="check-toggle" style="color: var(--accent); font-weight: bold;">
                        <input type="checkbox" id="center_all"> Centralizar todos em (0,0,0)
                    </label>
                </div>

                <div class="btn-grid">
                    <button class="control-btn" id="btn_f0">Toroide (Fluxo)</button>
                    <button class="control-btn" id="btn_f1">Cubo e Octaedro</button>
                    <button class="control-btn active" id="btn_f2">Dodecaedro e Icosaedro</button>
                    <button class="control-btn" id="btn_f3">Stella Octangula</button>
                    <button class="control-btn" id="btn_f4">Esfera Geodésica</button>
                    <button class="control-btn" id="toggle-rot" style="text-align:center; margin-top:5px; background: rgba(0,212,255,0.2);">Pausar Rotação</button>
                </div>
            </div>

            <div class="section">
                <h2>Parâmetros por Figura</h2>
                
                <!-- Toroide -->
                <div class="control-group">
                    <div class="label-row"><span>Toroide</span></div>
                    <div class="toggles-row">
                        <label class="check-toggle"><input type="checkbox" id="vis_torus" checked> Visível</label>
                        <label class="check-toggle"><input type="checkbox" id="wire_torus" checked> Wireframe</label>
                    </div>
                    <input type="range" id="scale_torus" min="0.1" max="2.5" step="0.1" value="1.0">
                    <div class="label-row"><small>Escala</small><span class="val-display" id="label_torus">1.0</span></div>
                </div>

                <!-- Cubo -->
                <div class="control-group">
                    <div class="label-row"><span>Cubo</span></div>
                    <div class="toggles-row">
                        <label class="check-toggle"><input type="checkbox" id="vis_cube" checked> Visível</label>
                        <label class="check-toggle"><input type="checkbox" id="wire_cube" checked> Wireframe</label>
                    </div>
                    <input type="range" id="scale_cube" min="0.1" max="2.5" step="0.1" value="1.0">
                    <div class="label-row"><small>Escala</small><span class="val-display" id="label_cube">1.0</span></div>
                </div>

                <!-- Octaedro -->
                <div class="control-group">
                    <div class="label-row"><span>Octaedro</span></div>
                    <div class="toggles-row">
                        <label class="check-toggle"><input type="checkbox" id="vis_octa" checked> Visível</label>
                        <label class="check-toggle"><input type="checkbox" id="wire_octa"> Wireframe</label>
                    </div>
                    <input type="range" id="scale_octa" min="0.1" max="2.5" step="0.1" value="1.0">
                    <div class="label-row"><small>Escala</small><span class="val-display" id="label_octa">1.0</span></div>
                </div>

                <!-- Dodecaedro -->
                <div class="control-group">
                    <div class="label-row"><span>Dodecaedro</span></div>
                    <div class="toggles-row">
                        <label class="check-toggle"><input type="checkbox" id="vis_dodeca" checked> Visível</label>
                        <label class="check-toggle"><input type="checkbox" id="wire_dodeca" checked> Wireframe</label>
                    </div>
                    <input type="range" id="scale_dodeca" min="0.1" max="2.5" step="0.1" value="1.0">
                    <div class="label-row"><small>Escala</small><span class="val-display" id="label_dode">1.0</span></div>
                </div>

                <!-- Icosaedro -->
                <div class="control-group">
                    <div class="label-row"><span>Icosaedro</span></div>
                    <div class="toggles-row">
                        <label class="check-toggle"><input type="checkbox" id="vis_icosa" checked> Visível</label>
                        <label class="check-toggle"><input type="checkbox" id="wire_icosa"> Wireframe</label>
                    </div>
                    <input type="range" id="scale_icosa" min="0.1" max="2.5" step="0.1" value="1.0">
                    <div class="label-row"><small>Escala</small><span class="val-display" id="label_icosa">1.0</span></div>
                </div>

                <!-- Tetraedro 1 -->
                <div class="control-group">
                    <div class="label-row"><span>Tetraedro 1</span></div>
                    <div class="toggles-row">
                        <label class="check-toggle"><input type="checkbox" id="vis_tetra1" checked> Visível</label>
                        <label class="check-toggle"><input type="checkbox" id="wire_tetra1"> Wireframe</label>
                    </div>
                    <input type="range" id="scale_tetra1" min="0.1" max="2.5" step="0.1" value="1.0">
                    <div class="label-row"><small>Escala</small><span class="val-display" id="label_t1">1.0</span></div>
                </div>

                <!-- Tetraedro 2 -->
                <div class="control-group">
                    <div class="label-row"><span>Tetraedro 2</span></div>
                    <div class="toggles-row">
                        <label class="check-toggle"><input type="checkbox" id="vis_tetra2" checked> Visível</label>
                        <label class="check-toggle"><input type="checkbox" id="wire_tetra2"> Wireframe</label>
                    </div>
                    <input type="range" id="scale_tetra2" min="0.1" max="2.5" step="0.1" value="1.0">
                    <div class="label-row"><small>Escala</small><span class="val-display" id="label_t2">1.0</span></div>
                </div>

                <!-- Esfera Geodésica -->
                <div class="control-group">
                    <div class="label-row"><span>Esfera Geo</span></div>
                    <div class="toggles-row">
                        <label class="check-toggle"><input type="checkbox" id="vis_geo" checked> Visível</label>
                        <label class="check-toggle"><input type="checkbox" id="wire_geo" checked> Wireframe</label>
                    </div>
                    <input type="range" id="scale_geo" min="0.1" max="2.5" step="0.1" value="1.0">
                    <div class="label-row"><small>Escala</small><span class="val-display" id="label_geo">1.0</span></div>
                </div>
            </div>
        </div>
    </div>

    <script>
        let scene, camera, renderer, controls;
        let groups = [], isRotating = true;
        const meshes = {};
        const groupOffsets = [-16, -8, 0, 8, 16];

        function init() {
            scene = new THREE.Scene();
            scene.background = new THREE.Color(0x05050a);
            scene.fog = new THREE.FogExp2(0x05050a, 0.03);

            camera = new THREE.PerspectiveCamera(60, window.innerWidth / window.innerHeight, 0.1, 1000);
            camera.position.set(0, 8, 20);

            renderer = new THREE.WebGLRenderer({ antialias: true });
            renderer.setSize(window.innerWidth, window.innerHeight);
            renderer.setPixelRatio(window.devicePixelRatio);
            document.body.appendChild(renderer.domElement);

            if (typeof THREE.OrbitControls !== 'undefined') {
                controls = new THREE.OrbitControls(camera, renderer.domElement);
                controls.enableDamping = true;
                controls.dampingFactor = 0.05;
            }

            const ambient = new THREE.AmbientLight(0xffffff, 0.6);
            scene.add(ambient);

            const light1 = new THREE.PointLight(0x00d4ff, 1.5);
            light1.position.set(10, 20, 10);
            scene.add(light1);

            const light2 = new THREE.PointLight(0xff0055, 1.2);
            light2.position.set(-15, -10, 5);
            scene.add(light2);

            createGeometries();
            setupEvents();
            animate();
        }

        function createGeometries() {
            // Grupo 0: Torus
            const g0 = new THREE.Group();
            meshes.torus = new THREE.Mesh(
                new THREE.TorusGeometry(2, 0.8, 16, 100),
                new THREE.MeshPhongMaterial({ color: 0x8844ff, wireframe: true, transparent: true, opacity: 0.6 })
            );
            g0.add(meshes.torus);
            g0.position.x = groupOffsets[0];
            scene.add(g0);
            groups.push(g0);

            // Grupo 1: Cubo e Octaedro
            const g1 = new THREE.Group();
            meshes.cube = new THREE.Mesh(
                new THREE.BoxGeometry(3, 3, 3),
                new THREE.MeshPhongMaterial({ color: 0x00d4ff, wireframe: true, transparent: true, opacity: 0.6 })
            );
            meshes.octa = new THREE.Mesh(
                new THREE.OctahedronGeometry(1.6),
                new THREE.MeshPhongMaterial({ color: 0xffaa00, shininess: 100, side: THREE.DoubleSide })
            );
            g1.add(meshes.cube, meshes.octa);
            g1.position.x = groupOffsets[1];
            scene.add(g1);
            groups.push(g1);

            // Grupo 2: Dodecaedro e Icosaedro
            const g2 = new THREE.Group();
            meshes.dodeca = new THREE.Mesh(
                new THREE.DodecahedronGeometry(1.8),
                new THREE.MeshPhongMaterial({ color: 0xff0055, wireframe: true, transparent: true, opacity: 0.6 })
            );
            meshes.icosa = new THREE.Mesh(
                new THREE.IcosahedronGeometry(1.4),
                new THREE.MeshPhongMaterial({ color: 0x00ffaa, transparent: true, opacity: 0.8, side: THREE.DoubleSide })
            );
            g2.add(meshes.dodeca, meshes.icosa);
            g2.position.x = groupOffsets[2];
            scene.add(g2);
            groups.push(g2);

            // Grupo 3: Stella Octangula
            const g3 = new THREE.Group();
            const tetraGeo = new THREE.TetrahedronGeometry(1.8);
            meshes.tetra1 = new THREE.Mesh(tetraGeo, new THREE.MeshPhongMaterial({ color: 0xffff00, side: THREE.DoubleSide }));
            meshes.tetra2 = new THREE.Mesh(tetraGeo, new THREE.MeshPhongMaterial({ color: 0xff5500, side: THREE.DoubleSide }));
            meshes.tetra2.rotation.set(Math.PI, 0, 0);
            g3.add(meshes.tetra1, meshes.tetra2);
            g3.position.x = groupOffsets[3];
            scene.add(g3);
            groups.push(g3);

            // Grupo 4: Esfera Geodésica
            const g4 = new THREE.Group();
            meshes.geo = new THREE.Mesh(
                new THREE.IcosahedronGeometry(2, 2),
                new THREE.MeshPhongMaterial({ color: 0xffffff, wireframe: true, transparent: true, opacity: 0.7 })
            );
            g4.add(meshes.geo);
            g4.position.x = groupOffsets[4];
            scene.add(g4);
            groups.push(g4);
        }

        function setupEvents() {
            document.getElementById('gear-btn').onclick = () => {
                document.getElementById('settings-panel').classList.toggle('hidden');
            };

            // Centralização Global
            document.getElementById('center_all').onchange = (e) => {
                const isCentered = e.target.checked;
                groups.forEach((g, i) => {
                    g.position.x = isCentered ? 0 : groupOffsets[i];
                });
                if(controls) controls.target.set(0, 0, 0);
            };

            // Foco Individual
            [0,1,2,3,4].forEach(i => {
                document.getElementById(`btn_f${i}`).onclick = () => {
                    const isCentered = document.getElementById('center_all').checked;
                    const xTarget = isCentered ? 0 : groupOffsets[i];
                    if(controls) controls.target.set(xTarget, 0, 0);
                    for(let j=0; j<5; j++) document.getElementById(`btn_f${j}`).classList.toggle('active', i === j);
                };
            });

            document.getElementById('toggle-rot').onclick = (e) => {
                isRotating = !isRotating;
                e.target.innerText = isRotating ? "Pausar Rotação" : "Iniciar Rotação";
            };

            const ids = ['torus', 'cube', 'octa', 'dodeca', 'icosa', 'tetra1', 'tetra2', 'geo'];
            const labelMap = { tetra1: 't1', tetra2: 't2', geo: 'geo' };
            
            ids.forEach(id => {
                // Escala
                const slider = document.getElementById(`scale_${id}`);
                if (slider) {
                    slider.oninput = (e) => {
                        const val = parseFloat(e.target.value);
                        if(meshes[id]) meshes[id].scale.set(val, val, val);
                        document.getElementById(`label_${labelMap[id] || id}`).innerText = val.toFixed(1);
                    };
                }

                // Wireframe
                const wireCheck = document.getElementById(`wire_${id}`);
                if (wireCheck) {
                    wireCheck.onchange = (e) => {
                        if(meshes[id]) meshes[id].material.wireframe = e.target.checked;
                    };
                }

                // Visibilidade
                const visCheck = document.getElementById(`vis_${id}`);
                if (visCheck) {
                    visCheck.onchange = (e) => {
                        if(meshes[id]) meshes[id].visible = e.target.checked;
                    };
                }
            });

            window.addEventListener('resize', onWindowResize);
        }

        function onWindowResize() {
            camera.aspect = window.innerWidth / window.innerHeight;
            camera.updateProjectionMatrix();
            renderer.setSize(window.innerWidth, window.innerHeight);
        }

        function animate() {
            requestAnimationFrame(animate);
            if (isRotating) {
                groups.forEach(g => {
                    g.rotation.y += 0.005;
                    g.rotation.z += 0.002;
                });
            }
            if (controls) controls.update();
            renderer.render(scene, camera);
        }

        window.onload = init;
    </script>
</body>
</html>

